<html>
<head>
<title>Modern Python Environments - dependency and workspace management </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>现代Python环境——依赖性和工作空间管理</h1>
<blockquote>原文：<a href="https://testdriven.io/blog/python-environments/#0001-01-01">https://testdriven.io/blog/python-environments/#0001-01-01</a></blockquote><div><div class="blog-content long-content" data-local-nav-source="">
    <p>一旦您经历了为单个“hello world”风格的应用程序设置Python环境的痛苦，您将需要经历一个更加困难的过程，弄清楚如何为多个Python项目管理多个环境。一些项目可能是新的，而另一些则是十年前的陈旧代码。幸运的是，有许多工具可以帮助简化依赖性和工作空间管理。</p>
<p>在本文中，我们将回顾用于依赖性和工作空间管理的可用工具，以便解决以下问题:</p>
<ol>
<li>在同一台机器上安装和切换不同版本的Python</li>
<li>管理依赖关系和虚拟环境</li>
<li>复制环境</li>
</ol>
<blockquote>
<p><a href="/guides/complete-python/">完整Python </a>指南:</p>
<ol>
<li><a href="/blog/python-environments/">现代Python环境——依赖性和工作空间管理</a>(本文！)</li>
<li><a href="/blog/testing-python/">Python中的测试</a></li>
<li><a href="/blog/modern-tdd/">Python中的现代测试驱动开发</a></li>
<li><a href="/blog/python-code-quality/"> Python代码质量</a></li>
<li><a href="/blog/python-type-checking/"> Python类型检查</a></li>
<li><a href="/blog/documenting-python/">记录Python代码和项目</a></li>
<li><a href="/blog/python-project-workflow/"> Python项目工作流程</a></li>
</ol>
</blockquote>



<h2 id="installing-python">安装Python</h2>
<p>虽然您可以从官方的二进制文件或通过系统的包管理器下载并安装Python，但是您应该避开这些方法，除非您足够幸运地在当前和未来的项目中使用相同版本的Python。由于情况可能并非如此，我们建议用<a href="https://github.com/pyenv/pyenv"> pyenv </a>安装Python。</p>
<p>pyenv是一个工具，它简化了在同一台机器上不同版本Python之间的安装和切换。它保持Python的系统版本不变，这是一些操作系统正常运行所必需的，同时仍然可以根据特定项目的需求轻松切换Python版本。</p>
<blockquote>
<p>不幸的是，pyenv不能在Linux 的<a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux"> Windows子系统之外的Windows上工作。如果你是这种情况，请查看</a><a href="https://github.com/pyenv-win/pyenv-win"> pyenv-win </a>。</p>
</blockquote>
<p>一旦<a href="https://github.com/pyenv/pyenv#installation">安装了</a>，你就可以轻松地安装Python的特定版本，如下所示:</p>
<div class="codehilite"><pre><span/><code>$ pyenv install <span class="m">3</span>.8.5
$ pyenv install <span class="m">3</span>.8.6
$ pyenv install <span class="m">3</span>.9.0
$ pyenv install <span class="m">3</span>.10.2

$ pyenv versions
* system
  <span class="m">3</span>.8.5
  <span class="m">3</span>.8.6
  <span class="m">3</span>.9.0
  <span class="m">3</span>.10.2
</code></pre></div>

<p>然后，您可以像这样设置您的全局Python版本:</p>
<div class="codehilite"><pre><span/><code>$ pyenv global <span class="m">3</span>.8.6

$ pyenv versions
  system
  <span class="m">3</span>.8.5
* <span class="m">3</span>.8.6 <span class="o">(</span><span class="nb">set</span> by /Users/michael/.pyenv/version<span class="o">)</span>
  <span class="m">3</span>.9.0
  <span class="m">3</span>.10.2

$ python -V
Python <span class="m">3</span>.8.6
</code></pre></div>

<blockquote>
<p>请记住，这不会在系统级修改或影响Python。</p>
</blockquote>
<p>以类似的方式，您可以为当前文件夹设置Python解释器:</p>
<div class="codehilite"><pre><span/><code>$ pyenv <span class="nb">local</span> <span class="m">3</span>.10.2

$ pyenv versions
  system
  <span class="m">3</span>.8.5
  <span class="m">3</span>.8.6
  <span class="m">3</span>.9.0
* <span class="m">3</span>.10.2 <span class="o">(</span><span class="nb">set</span> by /Users/michael/repos/testdriven/python-environments/.python-version<span class="o">)</span>

$ python -V
Python <span class="m">3</span>.10.2
</code></pre></div>

<p>现在，每次在该文件夹中运行Python时，都将使用版本3.10.2。</p>
<blockquote>
<p>如果您发现您不能在不同版本的Python之间切换，您可能需要重新配置您的shell配置文件。详见<a href="https://github.com/pyenv/pyenv#installation">安装指南</a>。</p>
</blockquote>
<h2 id="managing-dependencies">管理依赖关系</h2>
<p>在本节中，我们将了解几个用于管理依赖关系和虚拟环境的工具。</p>
<h3 id="venv-pip">venv + pip</h3>
<p><a href="https://docs.python.org/3/library/venv.html"> venv </a>和<a href="https://pypi.org/project/pip/">pip</a>(<strong>p</strong>package<strong>I</strong>installer for<strong>p</strong>ython)，它们预装在Python的大多数版本中，分别是最流行的管理虚拟环境和包的工具。它们使用起来相当简单。</p>
<blockquote>
<p>虚拟环境可以防止依赖性版本冲突。您可以在不同的虚拟环境中安装同一依赖项的不同版本。</p>
</blockquote>
<p>您可以在当前文件夹中创建一个名为<em> my_venv </em>的新虚拟环境，如下所示:</p>


<p>创建好环境后，您仍然需要通过在虚拟环境中获取<em> activate </em>脚本来激活它:</p>
<div class="codehilite"><pre><span/><code>$ <span class="nb">source</span> my_venv/bin/activate
<span class="o">(</span>my_venv<span class="o">)</span>$
</code></pre></div>

<blockquote>
<p>停用运行<code>deactivate</code>。然后，为了重新激活，在根项目目录中运行<code>source my_venv/bin/activate</code>。</p>
</blockquote>
<p>在虚拟环境激活时运行<code>which python</code>将返回虚拟环境内Python解释器的路径:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>my_venv<span class="o">)</span>$ which python

/Users/michael/repos/testdriven/python-environments/my_venv/bin/python
</code></pre></div>

<p>您可以通过在激活虚拟环境的情况下运行<code>pip install &lt;package-name&gt;</code>来安装项目的本地包:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>my_venv<span class="o">)</span>$ python -m pip install requests
</code></pre></div>

<p>pip从<a href="https://pypi.org/"> PyPI </a> (Python包索引)下载包，然后在虚拟环境中提供给Python解释器。</p>
<p>为了环境的可再现性，您通常希望在一个<em> requirements.txt </em>文件中保存一个项目所需包的列表。您可以手动创建文件并添加它们，或者使用<a href="https://pip.pypa.io/en/latest/cli/pip_freeze/"> pip冻结</a>命令来生成它:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>my_venv<span class="o">)</span>$ python -m pip freeze &gt; requirements.txt

<span class="o">(</span>my_venv<span class="o">)</span>$ cat requirements.txt
<span class="nv">certifi</span><span class="o">==</span><span class="m">2021</span>.10.8
charset-normalizer<span class="o">==</span><span class="m">2</span>.0.12
<span class="nv">idna</span><span class="o">==</span><span class="m">3</span>.3
<span class="nv">requests</span><span class="o">==</span><span class="m">2</span>.27.1
<span class="nv">urllib3</span><span class="o">==</span><span class="m">1</span>.26.8
</code></pre></div>

<blockquote>
<p>想要只获取顶级依赖项(例如，<code>requests==2.27.1</code>)？检查一下<a href="https://pip-chill.readthedocs.io/en/latest/"> pip-chill </a>。</p>
</blockquote>
<p>虽然venv和pip都很容易使用，但与更现代的工具如<a href="https://python-poetry.org">poem</a>和<a href="https://github.com/pypa/pipenv"> Pipenv </a>相比，它们还是非常原始的。venv和pip对它使用的Python版本一无所知。您必须手动管理所有依赖关系和虚拟环境。你必须自己创建和管理<em> requirements.txt </em>文件。更重要的是，你必须手工分离开发(pytest，black，isort，...)和生产(Flask，Django，FastAPI，..)依赖关系，使用一个<em> requirements-dev.txt </em>文件。</p>
<p><em>需求-开发文本</em>:</p>
<div class="codehilite"><pre><span/><code># prod
-r requirements.txt

# dev
black==22.1.0
coverage==6.3.2
flake8==4.0.1
ipython==8.0.1
isort==5.10.1
pytest-django==4.5.2
pytest-cov==3.0.0
pytest-xdist==2.5.0
pytest-mock==3.7.0
</code></pre></div>

<p><em>需求. txt </em>:</p>
<div class="codehilite"><pre><span/><code>Django==4.0.2
django-allauth==0.49.0
django-crispy-forms==1.14.0
django-rq==2.5.1
django-rq-email-backend==0.1.3
gunicorn==20.1.0
psycopg2-binary==2.9.3
redis==4.1.4
requests==2.27.1
rq==1.10.1
whitenoise==6.0.0
</code></pre></div>

<p>诗歌和Pipenv结合了venv和pip的功能。它们还使分离开发和生产依赖变得容易，并通过锁文件实现确定性构建。他们与pyenv合作得很好。</p>
<blockquote>
<p>锁定文件锁定(或锁定)整个依赖关系树中的所有依赖关系版本。</p>
</blockquote>
<h3 id="poetry">诗意</h3>
<p>诗歌可以说是Python中功能最丰富的依赖管理工具。它附带了一个用于创建和管理Python项目的强大的CLI。一旦<a href="https://python-poetry.org/docs/#installation">安装了</a>，脚手架上一个新的项目开始运行:</p>
<div class="codehilite"><pre><span/><code>$ poetry new sample-project
$ <span class="nb">cd</span> sample-project
</code></pre></div>

<p>这将创建以下文件和文件夹:</p>
<div class="codehilite"><pre><span/><code>sample-project
├── README.rst
├── pyproject.toml
├── sample_project
│   └── __init__.py
└── tests
    ├── __init__.py
    └── test_sample_project.py
</code></pre></div>

<p>依赖项在<em> pyproject.toml </em>文件中进行管理:</p>
<div class="codehilite"><pre><span/><code><span class="k">[tool.poetry]</span><span class="w"/>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"sample-project"</span><span class="w"/>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"0.1.0"</span><span class="w"/>
<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span><span class="w"/>
<span class="n">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">"John Doe &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8ae0e5e2e4caeee5efa4e9e5e7">[email protected]</a>&gt;"</span><span class="p">]</span><span class="w"/>

<span class="k">[tool.poetry.dependencies]</span><span class="w"/>
<span class="n">python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"^3.10"</span><span class="w"/>

<span class="k">[tool.poetry.dev-dependencies]</span><span class="w"/>
<span class="n">pytest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"^5.2"</span><span class="w"/>

<span class="k">[build-system]</span><span class="w"/>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">"poetry-core&gt;=1.0.0"</span><span class="p">]</span><span class="w"/>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"poetry.core.masonry.api"</span><span class="w"/>
</code></pre></div>

<blockquote>
<p>更多关于pyproject.toml的信息，新的Python包配置文件将“每个项目都视为一个包”，查看<a href="https://snarky.ca/what-the-heck-is-pyproject-toml/">py project . toml到底是什么？</a>文章。</p>
</blockquote>
<p>要添加新的依赖项，只需运行:</p>
<div class="codehilite"><pre><span/><code>$ poetry add <span class="o">[</span>--dev<span class="o">]</span> &lt;package name&gt;
</code></pre></div>

<blockquote>
<p><code>--dev</code>标志表示该依赖关系仅用于开发模式。默认情况下，不会安装开发依赖项。</p>
</blockquote>
<p>例如:</p>


<p>这将从PyPI下载并安装Flask到poem管理的虚拟环境中，将它和所有子依赖项一起添加到<em>poem . lock</em>文件中，并自动将它(一个顶级依赖项)添加到<em> pyproject.toml </em>:</p>
<div class="codehilite"><pre><span/><code><span class="k">[tool.poetry.dependencies]</span><span class="w"/>
<span class="n">python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"^3.10"</span><span class="w"/>
<span class="n">Flask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"^2.0.3"</span><span class="w"/>
</code></pre></div>

<p>注意<a href="https://python-poetry.org/docs/basic-usage#version-constraints">版本约束</a> : <code>"^2.0.3"</code>。</p>
<p>要在虚拟环境中运行一个命令，在命令前加上前缀<a href="https://python-poetry.org/docs/cli/#run">poem run</a>。例如，使用<code>pytest</code>运行测试:</p>
<div class="codehilite"><pre><span/><code>$ poetry run python -m pytest
</code></pre></div>

<p><code>poetry run &lt;command&gt;</code>将在虚拟环境内运行命令。不过，它不会激活虚拟环境。要激活诗歌的虚拟环境，你需要运行<code>poetry shell</code>。要停用它，你可以简单地运行<code>exit</code>命令。因此，您可以在进行项目之前激活您的虚拟环境，并在完成后停用，或者您可以在整个开发过程中使用<code>poetry run &lt;command&gt;</code>。</p>
<p>最后，诗歌与pyenv配合得很好。查看官方文档中的<a href="https://python-poetry.org/docs/managing-environments/">管理环境</a>，了解更多相关信息。</p>
<h3 id="pipenv">Pipenv</h3>
<p>Pipenv试图解决与诗歌相同的问题:</p>
<ol>
<li>管理依赖关系和虚拟环境</li>
<li>复制环境</li>
</ol>
<p>一旦<a href="https://github.com/pypa/pipenv#installation">安装了</a>，要用Pipenv创建一个新项目，运行:</p>
<div class="codehilite"><pre><span/><code>$ mkdir sample-project
$ <span class="nb">cd</span> sample-project
$ pipenv --python <span class="m">3</span>.10.2
</code></pre></div>

<p>这将创建一个新的虚拟环境，并将一个<em> Pipfile </em>添加到项目中:</p>
<div class="codehilite"><pre><span/><code><span class="k">[[source]]</span><span class="w"/>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"pypi"</span><span class="w"/>
<span class="na">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://pypi.org/simple"</span><span class="w"/>
<span class="na">verify_ssl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"/>

<span class="k">[dev-packages]</span><span class="w"/>

<span class="k">[packages]</span><span class="w"/>

<span class="k">[requires]</span><span class="w"/>
<span class="na">python_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"3.10"</span><span class="w"/>
</code></pre></div>

<blockquote>
<p>一个<em> Pipfile </em>的工作方式很像诗歌世界中的<em> pyproject.toml </em>文件。</p>
</blockquote>
<p>您可以像这样安装一个新的依赖项:</p>
<div class="codehilite"><pre><span/><code>$ pipenv install <span class="o">[</span>--dev<span class="o">]</span> &lt;package name&gt;
</code></pre></div>

<blockquote>
<p><code>--dev</code>标志表示该依赖关系仅用于开发模式。默认情况下，不会安装开发依赖项。</p>
</blockquote>
<p>例如:</p>


<p>与诗歌一样，Pipenv在虚拟环境中下载并安装Flask，将所有子依赖项固定在<em> Pipfile.lock </em>文件中，并将顶级依赖项添加到<em> Pipfile </em>中。</p>
<p>要在Pipenv管理的虚拟环境中运行脚本，您需要使用<a href="https://github.com/pypa/pipenv#-usage"> pipenv run </a>命令来运行它。例如，要用<code>pytest</code>运行测试，运行:</p>
<div class="codehilite"><pre><span/><code>$ pipenv run python -m pytest
</code></pre></div>

<p>像诗歌一样，<code>pipenv run &lt;command&gt;</code>将从虚拟环境内部运行命令。要激活Pipenv的虚拟环境，您需要运行<code>pipenv shell</code>。要停用它，你可以运行<code>exit</code>。</p>
<p>Pipenv与pyenv配合也很好。例如，当您想从尚未安装的Python版本创建一个虚拟环境时，它会询问您是否想先用pyenv安装它:</p>
<div class="codehilite"><pre><span/><code>$ pipenv --python <span class="m">3</span>.7.5

Warning: Python <span class="m">3</span>.7.5 was not found on your system…
Would you like us to install CPython <span class="m">3</span>.7.5 with Pyenv? <span class="o">[</span>Y/n<span class="o">]</span>: Y
</code></pre></div>

<h3 id="recommendations">推荐</h3>
<p>我应该使用哪个？</p>
<ol>
<li>venv和pip</li>
<li>诗意</li>
<li>Pipenv</li>
</ol>
<p>建议从venv和pip开始。他们是最容易共事的。熟悉他们，自己想清楚他们擅长什么，欠缺什么。</p>
<p>诗歌还是Pipenv？</p>
<p>因为他们都解决相同的问题，这归结为个人偏好。</p>
<p>注意事项:</p>
<ol>
<li>用诗歌发布到PyPI要容易得多，所以如果你正在创建一个Python包，就用诗歌吧。</li>
<li>这两个项目在依赖关系解析方面都相当慢，所以如果你正在使用Docker，你可能想避开它们。</li>
<li>从开源开发的角度来看，诗歌的速度更快，可以说对用户的反馈更敏感。</li>
</ol>

<p>除了上述工具之外，还可以查看以下内容，以帮助您在同一台计算机上安装不同版本的Python并在不同版本之间进行切换，管理依赖关系和虚拟环境，以及再现环境:</p>
<ol>
<li>Docker是一个构建、部署和管理容器化应用的平台。它非常适合创造可复制的环境。</li>
<li>在数据科学和机器学习社区中非常受欢迎的Conda ，可以帮助管理依赖性和虚拟环境，以及复制环境。</li>
<li>当你只需要简化虚拟环境之间的切换并在一个地方管理它们时，<a href="https://virtualenvwrapper.readthedocs.io/en/latest/"> virtualenvwrapper </a>和<a href="https://github.com/pyenv/pyenv-virtualenv"> pyenv插件pyenv-virtualenv </a>值得一看。</li>
<li><a href="https://github.com/jazzband/pip-tools"> pip-tools </a>简化了依赖性管理和环境再现性。它经常与venv结合。</li>
</ol>
<table>
<thead>
<tr>
<th/>
<th>Python版本</th>
<th>依赖性管理</th>
<th>虚拟环境</th>
<th>环境再现性</th>
</tr>
</thead>
<tbody>
<tr>
<td>pyenv</td>
<td>✅</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>venv + pip</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>venv+pip-工具</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>诗意</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>Pipenv</td>
<td>❌</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>码头工人</td>
<td>❌</td>
<td>❌</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>康达</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
</tbody>
</table>
<h2 id="managing-a-project">管理项目</h2>
<p>让我们来看看如何使用pyenv和poems管理一个Flask项目。</p>
<p>首先，创建一个名为“flask_example”的新目录，并在其中移动:</p>
<div class="codehilite"><pre><span/><code>$ mkdir flask_example
$ <span class="nb">cd</span> flask_example
</code></pre></div>

<p>其次，用pyenv为项目设置Python版本:</p>


<p>接下来，用诗歌初始化一个新的Python项目:</p>
<div class="codehilite"><pre><span/><code>$ poetry init

Package name <span class="o">[</span>flask_example<span class="o">]</span>:
Version <span class="o">[</span><span class="m">0</span>.1.0<span class="o">]</span>:
Description <span class="o">[]</span>:
Author <span class="o">[</span>Your name &lt;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="374e58424577525a565e5b1954585a">[email protected]</a>&gt;, n to skip<span class="o">]</span>:
License <span class="o">[]</span>:
Compatible Python versions <span class="o">[</span>^3.10<span class="o">]</span>:

Would you like to define your main dependencies interactively? <span class="o">(</span>yes/no<span class="o">)</span> <span class="o">[</span>yes<span class="o">]</span> no
Would you like to define your development dependencies interactively? <span class="o">(</span>yes/no<span class="o">)</span> <span class="o">[</span>yes<span class="o">]</span> no
Do you confirm generation? <span class="o">(</span>yes/no<span class="o">)</span> <span class="o">[</span>yes<span class="o">]</span>
</code></pre></div>

<p>添加烧瓶:</p>


<p>最后但同样重要的是，添加<a href="https://pytest.org/"> pytest </a>作为开发依赖项:</p>
<div class="codehilite"><pre><span/><code>$ poetry add --dev pytest
</code></pre></div>

<p>现在我们已经建立了一个基本的环境，我们可以为单个端点编写一个测试。</p>
<p>添加一个名为<em> test_app.py </em>的文件:</p>
<div class="codehilite"><pre><span/><code><span class="kn">import</span> <span class="nn">pytest</span>

<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">client</span><span class="p">():</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'TESTING'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">client</span>


<span class="k">def</span> <span class="nf">test_health_check</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/health-check/'</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</code></pre></div>

<p>之后，将一个基本的Flask应用程序添加到一个名为<em> app.py </em>的新文件中:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/health-check/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">'OK'</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>现在，要运行测试，运行:</p>
<div class="codehilite"><pre><span/><code>$ poetry run python -m pytest
</code></pre></div>

<p>您可以像这样运行开发服务器:</p>
<div class="codehilite"><pre><span/><code>$ poetry run python -m flask run
</code></pre></div>

<blockquote>
<p>命令在poems的虚拟环境中运行一个命令。</p>
</blockquote>
<h2 id="conclusion">结论</h2>
<p>本文研究了解决以下与依赖关系和工作空间管理相关的问题的最流行的工具:</p>
<ol>
<li>在同一台机器上安装和切换不同版本的Python</li>
<li>管理依赖关系和虚拟环境</li>
<li>复制环境</li>
</ol>
<p>您在工作流程中使用的具体工具并不重要，重要的是您能够解决这些问题。挑选一些工具，让你在Python中轻松开发。实验。它们的存在是为了让你的日常开发工作流程变得更简单，这样你就可以尽可能地高效工作。尝试所有这些方法，并使用适合您的开发风格的方法。不做评判。</p>
<p>快乐编码。</p>
<blockquote>
<p><a href="/guides/complete-python/">完整Python </a>指南:</p>
<ol>
<li><a href="/blog/python-environments/">现代Python环境——依赖性和工作空间管理</a>(本文！)</li>
<li><a href="/blog/testing-python/">Python中的测试</a></li>
<li><a href="/blog/modern-tdd/">Python中的现代测试驱动开发</a></li>
<li><a href="/blog/python-code-quality/"> Python代码质量</a></li>
<li><a href="/blog/python-type-checking/"> Python类型检查</a></li>
<li><a href="/blog/documenting-python/">记录Python代码和项目</a></li>
<li><a href="/blog/python-project-workflow/"> Python项目工作流程</a></li>
</ol>
</blockquote>
  </div>

  </div>    
</body>
</html>