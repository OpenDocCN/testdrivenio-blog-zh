<html>
<head>
<title>Guide to Unit Testing Vue Components </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Vue组件单元测试指南</h1>
<blockquote>原文：<a href="https://testdriven.io/blog/vue-unit-testing/#0001-01-01">https://testdriven.io/blog/vue-unit-testing/#0001-01-01</a></blockquote><div><div class="blog-content long-content" data-local-nav-source="">
    <p>这篇文章是单元测试组件的指南。</p>
<p>我们将首先看看为什么单元测试对于创建可维护的软件是重要的，以及你应该测试什么。然后，我们将详细介绍如何:</p>
<ol>
<li>为Vue组件创建并运行单元测试</li>
<li>测试Vue组件的不同方面</li>
<li>使用模拟来测试异步功能</li>
<li>检查单元测试的代码覆盖率</li>
<li>构建您的单元测试文件</li>
</ol>
<blockquote>
<p>如果你有兴趣了解更多关于Vue的知识，可以看看我的课程:<a href="/courses/learn-vue/">通过构建和部署CRUD应用</a>来学习Vue。</p>
</blockquote>
<p><em>依赖关系</em>:</p>

<p>本文中使用的Vue Weather App项目的源代码(以及详细的安装说明)可以在GitLab上找到:<a href="https://gitlab.com/patkennedy79/vue-weather-app"> Vue Weather App </a>。</p>
<hr/>
<p>这是测试Vue应用的两部分系列的第一部分:</p>
<ol>
<li><a href="/blog/vue-unit-testing/">单元测试Vue组件指南</a>(本文！)</li>
<li><a href="/blog/vue-pinia-testing/">测试Vue中的Pinia数据存储</a></li>
</ol>



<h2 id="objectives">目标</h2>
<p>完成本文后，您应该能够:</p>
<ol>
<li>解释为什么单元测试很重要</li>
<li>描述你应该(和不应该)单元测试什么</li>
<li>为Vue组件开发单元测试套件</li>
<li>为Vue项目运行单元测试</li>
<li>利用单元测试套件中的<code>beforeEach()</code>和<code>afterEach()</code>函数</li>
<li>编写单元测试来测试Vue组件的实现细节</li>
<li>编写单元测试来测试Vue组件的行为方面(点击事件等)。)</li>
<li>解释嘲讽如何帮助简化单元测试</li>
<li>编写模拟库和测试异步函数的单元测试</li>
<li>检查单元测试的代码覆盖率</li>
<li>为测试Vue组件开发一个结构良好的单元测试文件</li>
</ol>
<h2 id="why-unit-test">为什么要进行单元测试？</h2>
<p>总的来说，测试有助于确保你的应用程序能像最终用户期望的那样工作。</p>
<p>具有高测试覆盖率的软件项目从来都不是完美的，但是它是软件质量的一个很好的初始指示器。此外，可测试的代码通常是一个好的软件架构的标志，这就是高级开发人员在整个开发生命周期中考虑测试的原因。</p>
<p>测试可以分为三个层次:</p>
<ol>
<li>单位</li>
<li>综合</li>
<li>端到端</li>
</ol>
<p>单元测试测试独立于依赖项的单个代码单元的功能。它们是防止代码库中出现错误和不一致的第一道防线。单元测试是测试驱动开发过程的基础部分。</p>
<p>单元测试提高了代码的可维护性。</p>
<p>可维护性指的是对您的代码或将来需要更新您的代码的其他开发人员进行错误修复或增强。</p>
<p>单元测试应该与<a href="https://en.wikipedia.org/wiki/Continuous_integration">持续集成</a> (CI)过程相结合，以确保您的单元测试不断地被执行，最好是在每次提交到您的存储库时。一套可靠的单元测试对于在最终用户在生产中遇到缺陷之前，在开发过程的早期快速捕捉缺陷是至关重要的。</p>
<h2 id="what-to-test">测试什么</h2>
<p>你应该测试什么？或者，更重要的是:你不应该测试什么？</p>
<p>对于单元测试，有三种类型的测试需要考虑:</p>
<ol>
<li><strong>实现细节</strong>:组件用来根据给定的输入产生结果的底层业务逻辑</li>
<li><strong>公共接口/设计合同</strong>:特定的输入(或道具，在这种情况下)产生特定的结果</li>
<li><strong>副作用</strong>:“如果这样，那就那样”；例如，当点击一个按钮时，会发生一些事情</li>
</ol>
<p>既然你不能测试所有的东西，你应该关注什么？</p>
<p>重点测试最终用户将与之交互的输入和输出。你的产品的用户体验是最重要的！</p>
<ol>
<li><strong>输入</strong>:数据、道具、用户交互、生命周期方法、数据存储(<a href="https://pinia.vuejs.org/">皮尼亚</a> / <a href="https://vuex.vuejs.org/"> Vuex </a>)、路线参数、查询字符串</li>
<li><strong>输出</strong>:渲染输出、事件、数据结果、数据存储(Pinia/Vuex)更新、调度</li>
</ol>
<p>通过集中测试软件模块的输入/输出(例如，Vue组件)，您正在测试最终用户将体验的关键方面。</p>
<p>软件模块中可能有其他复杂的内部逻辑，需要进行单元测试，但是这些类型的测试很可能需要在代码重构期间进行更新。</p>
<h2 id="app-overview">应用概述</h2>
<p>在讨论如何对Vue组件进行单元测试之前，我想简单介绍一下我们将要测试的Vue天气应用。</p>
<p>在克隆存储库之后，安装依赖项，并添加API密钥。</p>
<blockquote>
<p>查看项目的<a href="https://gitlab.com/patkennedy79/vue-weather-app/-/blob/main/README.md">自述文件</a>以获得更多关于从Open Weather创建和添加API密钥的信息。</p>
</blockquote>
<p>完成后，可以通过启动开发服务器在本地计算机上运行Vue Weather应用程序:</p>


<p>应用程序构建完成后，您将看到类似于以下内容的成功消息:</p>
<div class="codehilite"><pre><span/><code>vite v2.9.14 dev server running at:

 &gt; Local: http://localhost:3000/
 &gt; Network: use <span class="sb">`</span>--host<span class="sb">`</span> to expose

 ready <span class="k">in</span> 543ms.
</code></pre></div>

<p>此时，开发服务器将启动并运行。你可以通过在你最喜欢的网络浏览器中导航到<a href="http://localhost:3000"> http://localhost:3000 </a>来查看Vue应用。第一次加载app时，没有数据显示；您将会看到一个输入字段，用于输入您想要获取天气信息的城市:</p>
<p><img data-src="/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step1.png" loading="lazy" class="lazyload" alt="Vue Weather App Walkthrough - Step 1" src="../Images/144faac5e218c9c58416129b7e985ea2.png" data-original-src="https://testdriven.io/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step1.png"/></p>
<p>如果没有输入任何数据，“搜索”和“清除”按钮都将被禁用。</p>
<p>一旦您开始输入一个城市的数据(一旦添加了第一个字符)，“搜索”和“清除”按钮都将被启用:</p>
<p><img data-src="/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step2.png" loading="lazy" class="lazyload" alt="Vue Weather App Walkthrough - Step 2" src="../Images/088ae5cdf29fb4b05b90e26f6969b998.png" data-original-src="https://testdriven.io/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step2.png"/></p>
<p>如果您在输入有效城市后点击“搜索”，将显示该城市的天气数据:</p>
<p><img data-src="/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step3.png" loading="lazy" class="lazyload" alt="Vue Weather App Walkthrough - Step 3" src="../Images/3f5287a6e9fa4481d9a2072ee1b9d5ec.png" data-original-src="https://testdriven.io/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step3.png"/></p>
<p>此时，单击“清除天气数据”按钮将会清除天气数据:</p>
<p><img data-src="/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step4.png" loading="lazy" class="lazyload" alt="Vue Weather App Walkthrough - Step 4" src="../Images/e4678793fa106157cdeadebb40431b20.png" data-original-src="https://testdriven.io/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step4.png"/></p>
<p>但是，输入的城市将保留在输入字段中。</p>
<p>如果您现在单击“清除”,输入字段将被清除,“搜索”和“清除”按钮将再次被禁用:</p>
<p><img data-src="/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step5.png" loading="lazy" class="lazyload" alt="Vue Weather App Walkthrough - Step 5" src="../Images/fbf67081cc74c7ca5ae7c4272f393f05.png" data-original-src="https://testdriven.io/static/images/blog/vue-unit-testing/vue-weather-app_walkthrough_step5.png"/></p>
<p>如果输入无效城市会怎样？如果你在“清除天气数据”前点击“清除”会怎样？你还能找到app的哪些状态？</p>
<h2 id="unit-testing-in-vue">Vue中的单元测试</h2>
<p>因为组件是Vue(实际上是任何<a href="https://en.wikipedia.org/wiki/Single-page_application"> SPA </a>框架)的组成部分，所以它们是整个应用程序中最关键的部分。所以，把分配给你的大部分测试时间花在编写测试应用组件的单元测试上。</p>
<p>根据我对Vue组件进行单元测试的经验，我发现测试工具和框架——Vite和Vitest——满足了良好测试环境的关键方面:</p>
<ul>
<li>编写测试既简单又有趣</li>
<li>测试可以快速编写</li>
<li>可以用一个命令来执行测试</li>
<li>测试运行迅速</li>
</ul>
<p>希望你会发现对你的Vue组件进行单元测试是一种愉快的经历，因为我认为这是鼓励更多测试的关键。</p>

<p>我们将使用两种工具对Vue组件进行单元测试:</p>
<ol>
<li><a href="https://vitest.dev"> Vitest </a> -单元测试框架</li>
<li>Vue测试工具-Vue的单元测试工具库</li>
</ol>
<p>Vitest是一个单元测试框架，其目标是与框架无关的，因此它可以用于测试Vue、React、Svelte、Lit和其他项目。Vitest被配置为与Vite一起运行，这导致了<strong>快速的</strong>测试执行。</p>
<blockquote>
<p>如果您熟悉Jest，切换到使用Vitest非常简单，因为Vitest的API与Jest兼容。</p>
</blockquote>
<p>为Vue组件编写单元测试时，Vitest和Vue测试实用程序提供了以下功能:</p>
<p><strong> Vitest </strong></p>
<ul>
<li>运行测试和检查测试覆盖率的命令行工具</li>
<li>直观地查看测试结果和覆盖率结果的用户界面</li>
<li>编写单元测试的函数(<code>it</code>，<code>describe</code>)</li>
<li>对照期望值进行检查的功能(<code>expect</code>、<code>toMatch</code>、<code>toContain</code>等)。)</li>
<li>嘲讽(<code>mockResolvedValue</code>，<code>mockRejectedValue</code>)</li>
<li>设置(<code>beforeEach</code>、<code>beforeAll</code> ) /拆卸(<code>afterEach</code>、【T3”)</li>
</ul>
<p><strong>vista测试有用</strong></p>
<ul>
<li>安装组件(<code>mount</code>、<code>shallowMount</code>)</li>
<li>设置道具数据(<code>setProps</code>)</li>
<li>寻找用于测试的HTML组件(<code>findAll('h2')</code>)</li>
<li>清除所有承诺的实用程序(<code>flushPromises()</code>)</li>
<li>触发点击事件的实用程序(<code>trigger</code>)</li>
<li>检查发出事件的实用程序(<code>emitted</code>)</li>
</ul>
<blockquote>
<p>Vitest提供了编写单元测试的通用功能，而Vue Test Utils提供了特定于Vue的测试工具。</p>
</blockquote>
<h3 id="unit-testing-overview">单元测试概述</h3>
<p>首先，让我们讨论一下Vue中单元测试的命名约定。单元测试文件应该采用以下格式:</p>

<blockquote>
<p>根据<a href="https://v2.vuejs.org/v2/style-guide/?redirect=true#Multi-word-component-names-essential"> Vue风格指南</a>，组件名应该是多个单词(<code>WeatherHeader</code>而不是仅仅<code>Header</code>)，以防止与HTML元素冲突。</p>
</blockquote>
<p>通常，Vue项目中的每个组件都应该有一个单元测试文件。在每个单元测试文件中，可以有单个单元测试套件或多个单元测试套件。</p>
<p>单元测试文件应该放在<em>组件</em>文件夹(<em> src/components/__tests__ </em>)的子文件夹中:</p>
<div class="codehilite"><pre><span/><code>$ tree -d -L <span class="m">2</span>
.
├── node_modules
├── public
├── src
    ├── assets
    └── components
        └── __tests__
</code></pre></div>

<h3 id="running-the-tests">运行测试</h3>
<p>Vitest可用于运行单元测试，如下所示:</p>
<div class="codehilite"><pre><span/><code>$ npm run test:unit

✓ src/components/__tests__/WeatherFooter.spec.js <span class="o">(</span><span class="m">1</span><span class="o">)</span>
✓ src/components/__tests__/WeatherHeader.spec.js <span class="o">(</span><span class="m">1</span><span class="o">)</span>
✓ src/components/__tests__/WeatherResult.spec.js <span class="o">(</span><span class="m">3</span><span class="o">)</span>
✓ src/components/__tests__/WeatherBanner.spec.js <span class="o">(</span><span class="m">5</span><span class="o">)</span>
✓ src/components/__tests__/WeatherSearch.spec.js <span class="o">(</span><span class="m">5</span><span class="o">)</span>
✓ src/components/__tests__/App.spec.js <span class="o">(</span><span class="m">7</span><span class="o">)</span>

Test Files  <span class="m">6</span> passed <span class="o">(</span><span class="m">6</span><span class="o">)</span>
    Tests  <span class="m">22</span> passed <span class="o">(</span><span class="m">22</span><span class="o">)</span>
     Time  <span class="m">2</span>.38s <span class="o">(</span><span class="k">in</span> thread 640ms, <span class="m">371</span>.13%<span class="o">)</span>
</code></pre></div>

<blockquote>
<p>通过<code>npm</code>为你的Vue项目运行的所有可用命令都在<em> package.json </em>的<code>scripts</code>字段中定义。</p>
</blockquote>
<p>Vitest的默认配置是在<a href="https://vitest.dev/guide/features.html#watch-mode">监视模式</a>下运行测试，这意味着每次保存到一个适用的文件时，测试套件都会被重新执行。要更改此配置，使Vitest只运行一次(没有“监视模式”)，请更新<em> package.json </em>中的<code>test:unit</code>配置，以包含<code>run</code>参数:</p>
<div class="codehilite"><pre><span/><code><span class="nt">"test:unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vitest run --environment jsdom"</span><span class="p">,</span><span class="w"/>
</code></pre></div>

<h2 id="examples">例子</h2>
<p>使用<a href="https://gitlab.com/patkennedy79/vue-weather-app"> Vue天气应用</a>，让我们看一些测试Vue组件的例子。</p>
<h3 id="example-1-unit-test-introduction">示例1 -单元测试介绍</h3>
<p>让我们直接看一个Vue中单元测试文件的例子！第一个单元测试文件位于<em>src/components/_ _ tests _ _/weather header . spec . js</em>中，它测试<code>WeatherHeader</code>组件:</p>
<div class="codehilite"><pre><span/><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'vitest'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">shallowMount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'@vue/test-utils'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="nx">WeatherHeader</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../WeatherHeader.vue'</span><span class="w"/>


<span class="nx">describe</span><span class="p">(</span><span class="s1">'WeatherHeader.vue Test'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'renders message when component is created'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="c1">// render the component</span><span class="w"/>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">(</span><span class="nx">WeatherHeader</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="nx">propsData</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">'Vue Project'</span><span class="w"/>
<span class="w">      </span><span class="p">}</span><span class="w"/>
<span class="w">    </span><span class="p">})</span><span class="w"/>

<span class="w">    </span><span class="c1">// check that the title is rendered</span><span class="w"/>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Vue Project'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<h4 id="mounting">增加</h4>
<p>该文件中的第一行从Vitest中导入该文件中使用的测试函数。</p>
<blockquote>
<p>如果你想让Vitest API全球可用(比如Jest是如何工作的)，那么在<em> vite.config.js </em>中的<code>defineConfig()</code>函数中添加<code>test: {globals: true}</code>。更多详情，请查看Vitest <a href="https://vitest.dev/config/#globals">文档</a>。</p>
</blockquote>
<p>该文件的第二行从Vue Test Utils库中导入了一个名为<code>shallowMount</code>的函数。“安装”的概念意味着加载单个组件，以便能够对其进行测试。在Vue测试工具中有两种方法:</p>
<ul>
<li><code>shallowMount()</code> -为Vue组件创建一个<code>wrapper</code>，但是带有存根子组件</li>
<li><code>mount()</code> -为Vue组件创建一个<code>wrapper</code>，包括安装任何子组件</li>
</ul>
<p>因为我们的重点是测试单个组件(<code>WeatherHeader</code>组件)，所以我们将使用<code>shallowMount()</code>。</p>
<blockquote>
<p><code>shallowMount()</code>更适合单独测试单个组件，因为子组件被剔除了。这是<strong>单元</strong>测试的理想情况。</p>
<p>此外，使用<code>shallowMount()</code>来测试一个有很多子组件的组件可以改善单元测试的执行时间，因为渲染子组件没有成本(就时间而言)。</p>
<p>当你想要测试子组件的行为时,<code>mount()</code>是有用的。</p>
</blockquote>
<p>第三行导入将要测试的Vue组件，<em> WeatherHeader.vue </em>。</p>
<h4 id="describe-blocks">描述块</h4>
<p>在<code>import</code>语句之后，有一个定义单元测试套件的<code>describe</code>块。</p>
<p>在一个单元测试文件中，可以有多个定义不同单元测试套件的<code>describe</code>块。类似地，每个<code>describe</code>块可以包含多个单元测试，其中每个单元测试由一个<code>it</code>块定义。</p>
<p>我认为这种区别是:</p>
<ul>
<li>块单元测试套件</li>
<li><code>it</code>块-单个单元测试功能</li>
</ul>
<p>使用Vitest进行单元测试的好处是有几个内置的鼓励添加注释的方法。例如，<code>describe</code>的第一个参数应该清楚地解释哪个Vue组件正在被测试:</p>
<div class="codehilite"><pre><span/><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'WeatherHeader.vue Test'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span><span class="w"/>
</code></pre></div>

<p>对于每个<code>it</code>块，第一个参数是测试函数的描述，它应该是这个特定测试正在做什么的简短描述。在上面的例子中，<code>it</code>块测试组件“在创建组件时呈现消息”。</p>
<h4 id="expects">预计</h4>
<p>至于实际的单元测试，第一步是安装Vue组件，以便可以对其进行测试:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// render the component</span><span class="w"/>
<span class="kd">const</span><span class="w"> </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">(</span><span class="nx">WeatherHeader</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">propsData</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">'Vue Project'</span><span class="w"/>
<span class="w">  </span><span class="p">}</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p><code>shallowMount</code>函数返回一个<code>wrapper</code>对象，它包含已安装的组件和测试该组件的方法。<code>wrapper</code>对象允许我们测试Vue组件生成的HTML的所有方面以及Vue组件的所有属性(比如数据)。</p>
<p>此外，传递到<code>WeatherHeader</code>组件中的props作为第二个参数传递给<code>shallowMount()</code>。</p>
<p>单元测试中执行的实际检查是:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// check that the title is rendered</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Vue Project'</span><span class="p">)</span><span class="w"/>
</code></pre></div>

<p>这一行使用<code>wrapper</code>检查组件生成的标题是否为‘Vue Project’。由于该检查进行字符串比较，所以建议使用<code>toMatch()</code>。</p>
<h4 id="test-helpers">测试助手</h4>
<p>虽然单元测试文件中对组件<code>WeatherHeader</code>的检查只是检查字符串值，但是Vitest中有很多选项可以用来执行检查:</p>
<ul>
<li>布尔值:<ul>
<li><code>toBeTruthy()</code> -检查变量/语句是否为真</li>
<li><code>toBeFalsy()</code> -检查变量/语句是否为假</li>
</ul>
</li>
<li>已定义:<ul>
<li><code>toBeNull()</code> -检查变量是否只匹配空值</li>
<li><code>toBeUndefined()</code> -检查变量是否未定义</li>
<li><code>toBeDefined()</code> -检查变量是否已定义</li>
</ul>
</li>
<li>数字:<ul>
<li><code>toBeGreaterThan()</code> -检查数字是否大于指定值</li>
<li><code>toBeGreaterThanOrEqual()</code> -检查数字是否大于或等于指定值</li>
<li><code>toBeLessThan()</code> -检查数字是否小于指定值</li>
<li><code>toBeLessThanOrEqual()</code> -检查数字是否小于或等于指定值</li>
<li><code>toBe()</code>和<code>toEqual()</code> -检查数字是否与指定的值相同(这些函数对于数字是等效的)</li>
<li><code>toBeCloseTo()</code> -检查一个数字是否等于小容差内指定的值(对浮点数有用)</li>
</ul>
</li>
<li>字符串:<ul>
<li><code>toMatch()</code> -检查一个字符串是否等于指定的值(Regex可以用作指定的值！)</li>
</ul>
</li>
<li>数组:<ul>
<li><code>toContain()</code> -检查数组是否包含指定的值</li>
</ul>
</li>
</ul>
<p>此外，<code>not</code>限定符可以用于大多数检查:</p>
<div class="codehilite"><pre><span/><code><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Node Project'</span><span class="p">)</span><span class="w"/>
</code></pre></div>

<p>有关可用检查的完整列表，请查看<a href="https://vitest.dev/api/#expect"> Vitest API参考</a>。</p>
<h3 id="example-2-testing-initial-conditions">示例2 -测试初始条件</h3>
<p>这个例子展示了如何测试<code>WeatherResult</code>组件的初始条件(或状态)。</p>
<p>下面是单元测试文件的概要(在<em>src/components/_ _ tests _ _/weather result . spec . js</em>中定义):</p>
<div class="codehilite"><pre><span/><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">beforeEach</span><span class="p">,</span><span class="w"> </span><span class="nx">afterEach</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'vitest'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">,</span><span class="w"> </span><span class="nx">flushPromises</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'@vue/test-utils'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="nx">WeatherResult</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'@/components/WeatherResult.vue'</span><span class="w"/>


<span class="nx">describe</span><span class="p">(</span><span class="s1">'WeatherResult.vue Implementation Test'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"/>

<span class="w">  </span><span class="c1">// SETUP - run before to each unit test</span><span class="w"/>
<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="c1">// render the component</span><span class="w"/>
<span class="w">    </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">(</span><span class="nx">WeatherResult</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="nx">propsData</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nx">weatherSummary</span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nx">weatherDescription</span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nx">currentTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nx">lowTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nx">highTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w"/>
<span class="w">      </span><span class="p">}</span><span class="w"/>
<span class="w">    </span><span class="p">})</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="c1">// TEARDOWN - run after to each unit test</span><span class="w"/>
<span class="w">  </span><span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">unmount</span><span class="p">()</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'initializes with correct elements'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'processes valid props data'</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'emits a custom event when the Clear Weather Data button is clicked'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>单元测试文件利用<code>shallowMount()</code>函数来呈现<code>WeatherResult</code>组件，因为这个组件是作为一个独立的组件来测试的。</p>
<h4 id="beforeeach-and-aftereach-blocks">每个块之前和每个块之后</h4>
<p>在单元测试套件中(在<code>describe</code>块中定义)，定义了两个新函数:</p>
<ul>
<li><code>beforeEach()</code> -在执行<strong>之前被称为<strong>的本单元测试套件内的每个</strong>单元测试</strong></li>
<li><code>afterEach()</code>——在执行完本单元测试套件内的<strong>个</strong>单元测试后，称为<strong/></li>
</ul>
<p><code>beforeEach()</code>函数用于在运行每个单元测试之前设置一致的状态。这个概念对于确保运行单元测试的顺序不会影响单元测试的整体结果非常重要。</p>
<p>在这个例子中，<code>beforeEach()</code>函数使用一组默认的属性数据来呈现组件:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// SETUP - run before to each unit test</span><span class="w"/>
<span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// render the component</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">(</span><span class="nx">WeatherResult</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">propsData</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"/>
<span class="w">      </span><span class="nx">weatherSummary</span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"/>
<span class="w">      </span><span class="nx">weatherDescription</span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"/>
<span class="w">      </span><span class="nx">currentTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"/>
<span class="w">      </span><span class="nx">lowTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"/>
<span class="w">      </span><span class="nx">highTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w"/>
<span class="w">    </span><span class="p">}</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p><code>afterEach()</code>函数用于清除单元测试期间执行的任何处理。</p>
<p>在这个例子中，<code>afterEach()</code>函数卸载单元测试中使用的<code>wrapper</code>，这样<code>wrapper</code>可以在<code>beforeEach()</code>中为下一个单元测试重新初始化:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// TEARDOWN - run after to each unit test</span><span class="w"/>
<span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">unmount</span><span class="p">()</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>如果希望运行在整个单元测试套件运行之前或之后执行的代码，可以使用:</p>
<div class="codehilite"><pre><span/><code><span class="nx">beforeAll</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="cm">/* Runs before all tests */</span><span class="w"/>
<span class="p">})</span><span class="w"/>
<span class="nx">afterAll</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="cm">/* Runs after all tests */</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<h4 id="expects_1">预计</h4>
<p>第一个单元测试检查<code>WeatherResult</code>组件的初始状态:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">(</span><span class="s1">'initializes with correct elements'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// check that the heading text is rendered</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">length</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Weather Summary'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Temperatures'</span><span class="p">)</span><span class="w"/>

<span class="w">  </span><span class="c1">// check that 6 fields of data for the temperature are displayed</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">length</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">6</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'City:'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Summary:'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">2</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Details:'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">3</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Current: 0° F'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">4</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'High (Today): 0° F'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">5</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Low (Today): 0° F'</span><span class="p">)</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>检查:</p>
<ol>
<li><code>expect</code> s的第一部分检查两个标题(定义为<code>h2</code>元素)是否符合预期。</li>
<li><code>expect</code> s的第二部分检查六个数据字段(定义为<code>p</code>元素)是否符合预期。</li>
</ol>
<h3 id="example-3-testing-props">示例3 -测试道具</h3>
<p>第二个单元测试检查作为正确数据传入的有效数据是否被<code>WeatherResult</code>组件正确处理:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">(</span><span class="s1">'processes valid props data'</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// Update the props passed in to the WeatherResult component</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">setProps</span><span class="p">({</span><span class="w"/>
<span class="w">    </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="s1">'Chicago'</span><span class="p">,</span><span class="w"/>
<span class="w">    </span><span class="nx">weatherSummary</span><span class="o">:</span><span class="w"> </span><span class="s1">'Cloudy'</span><span class="p">,</span><span class="w"/>
<span class="w">    </span><span class="nx">weatherDescription</span><span class="o">:</span><span class="w"> </span><span class="s1">'Cloudy with a chance of rain'</span><span class="p">,</span><span class="w"/>
<span class="w">    </span><span class="nx">currentTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">45.1</span><span class="p">,</span><span class="w"/>
<span class="w">    </span><span class="nx">lowTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">42.0</span><span class="p">,</span><span class="w"/>
<span class="w">    </span><span class="nx">highTemperature</span><span class="o">:</span><span class="w"> </span><span class="mf">47.7</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="c1">// Wait until the DOM updates</span><span class="w"/>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">flushPromises</span><span class="p">()</span><span class="w"/>

<span class="w">  </span><span class="c1">// check that the prop data is stored as expected within the component</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">city</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Chicago'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherSummary</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Cloudy'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherDescription</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Cloudy with a chance of rain'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">currentTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">45.1</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">lowTemperature</span><span class="p">).</span><span class="nx">toBeCloseTo</span><span class="p">(</span><span class="mf">42.0</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">highTemperature</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">47.7</span><span class="p">)</span><span class="w"/>

<span class="w">  </span><span class="c1">// check that the heading text is rendered</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">length</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Weather Summary'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Temperatures'</span><span class="p">)</span><span class="w"/>

<span class="w">  </span><span class="c1">// check that 6 fields of data for the temperature are displayed</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">length</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">6</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'City: Chicago'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Summary: Cloudy'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">2</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Details: Cloudy with a chance of rain'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">3</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Current: 45.1° F'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">4</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'High (Today): 47.7° F'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'p'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">5</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Low (Today): 42° F'</span><span class="p">)</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>由于<code>beforeEach()</code>函数提供了一组默认的属性数据，我们需要使用<code>setProps()</code>函数覆盖属性数据。</p>
<p>为了确保prop数据在<code>WeatherResult</code>中引起预期的更新，测试需要等待所有的DOM更新生效:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// Wait until the DOM updates</span><span class="w"/>
<span class="k">await</span><span class="w"> </span><span class="nx">flushPromises</span><span class="p">()</span><span class="w"/>
</code></pre></div>

<blockquote>
<p>注意:只有用<code>async</code>定义函数时，才能使用<code>await</code>！</p>
</blockquote>
<p>检查:</p>
<ol>
<li>随着道具数据的更新，我们可以通过检查数据元素(使用<code>wrapper.vm</code>)来检查道具数据是否正确地存储在<code>WeatherResult</code>组件中。</li>
<li><code>expect</code> s的第二部分检查两个标题(定义为<code>h2</code>元素)是否符合预期。</li>
<li>最后一组<code>expect</code>检查prop数据是否用于按预期设置六个数据字段(定义为<code>p</code>元素)。</li>
</ol>
<h3 id="example-4-testing-user-input-click-event">示例4 -测试用户输入(点击事件)</h3>
<p>第三个单元测试检查当用户点击“清除天气数据”按钮时，<code>WeatherResult</code>组件发出了<code>clear-weather-data</code>事件:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">(</span><span class="s1">'emits a custom event when the Clear Weather Data button is clicked'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// trigger an event when the 'Clear Weather Data' button is clicked</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">'button'</span><span class="p">).</span><span class="nx">at</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'click'</span><span class="p">)</span><span class="w"/>

<span class="w">  </span><span class="c1">// check that 1 occurrence of the event has been emitted</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">emitted</span><span class="p">(</span><span class="s1">'clear-weather-data'</span><span class="p">)).</span><span class="nx">toBeTruthy</span><span class="p">()</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">emitted</span><span class="p">(</span><span class="s1">'clear-weather-data'</span><span class="p">).</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>要触发点击事件，必须在<code>wrapper</code>中找到<code>button</code>元素，然后调用<code>trigger</code>函数来触发点击事件。</p>
<p>单击按钮后，单元测试会检查是否只发出了一个定制事件(名称为<code>clear-weather-data</code>)。</p>
<h2 id="mocking-examples">嘲弄的例子</h2>
<p>在<code>App</code>组件中，当用户搜索一个城市的天气时，HTTP GET调用<a href="https://openweathermap.org"> Open Weather </a>通过名为<a href="https://github.com/axios/axios"> Axios </a>的第三方库检索数据:</p>
<div class="codehilite"><pre><span/><code><span class="kd">const</span><span class="w"> </span><span class="nx">searchCity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">inputCity</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// GET request for user data</span><span class="w"/>
<span class="w">  </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'http://api.openweathermap.org/data/2.5/weather?q='</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inputCity</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'&amp;units=imperial&amp;APPID='</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">openweathermapApiKey</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="c1">// handle success</span><span class="w"/>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"/>

<span class="w">      </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="w"/>
<span class="w">      </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">weatherSummary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">weather</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">main</span><span class="w"/>
<span class="w">      </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">weatherDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">weather</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">description</span><span class="w"/>
<span class="w">      </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">currentTemperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">temp</span><span class="w"/>
<span class="w">      </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">lowTemperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">temp_min</span><span class="w"/>
<span class="w">      </span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">highTemperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">temp_max</span><span class="w"/>
<span class="w">      </span><span class="nx">validWeatherData</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"/>
<span class="w">    </span><span class="p">})</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="c1">// handle error</span><span class="w"/>
<span class="w">      </span><span class="nx">messageType</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Error'</span><span class="w"/>
<span class="w">      </span><span class="nx">messageToDisplay</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ERROR! Unable to retrieve weather data for '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">inputCity</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'!'</span><span class="w"/>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span><span class="w"/>
<span class="w">      </span><span class="nx">resetData</span><span class="p">()</span><span class="w"/>
<span class="w">    </span><span class="p">})</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="k">finally</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="c1">// always executed</span><span class="w"/>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'HTTP GET Finished!'</span><span class="p">)</span><span class="w"/>
<span class="w">    </span><span class="p">})</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<p>当考虑如何测试HTTP GET调用时，两个场景浮现在脑海中，每个场景都测试实际API调用的副作用:</p>
<ul>
<li>HTTP GET响应成功(<em>快乐之路</em>)</li>
<li>HTTP GET响应失败(<em>异常路径</em>)</li>
</ul>
<p>当测试利用外部API的代码时，通常更容易的方法是不进行实际的调用，而是用一个模拟来代替调用。不过，这种方法有利也有弊。</p>
<p><strong>优点:</strong></p>
<ol>
<li>这些测试不依赖于网络请求</li>
<li>如果API下降，它们也不会中断</li>
<li>他们会跑得更快</li>
</ol>
<p><strong>缺点:</strong></p>
<ol>
<li>每当API模式改变时，您都需要更新测试</li>
<li>在微服务架构中，很难跟上API的变化</li>
<li>模仿是一个很难理解的概念，它们会给你的测试套件增加很多混乱</li>
</ol>
<blockquote>
<p>在某些时候，您应该检查完全集成，以确保API响应的形式没有改变。</p>
</blockquote>
<p>由于这篇文章关注的是单元测试，我们将<strong>模仿</strong>Axios库。</p>
<p>模仿提供了一种模仿软件模块预期行为的方法。虽然嘲讽可以用在生产代码中(非常危险！)，它通常在开发和测试期间使用。</p>
<p>从外部API加载数据需要时间。虽然在这个应用程序中从Open Weather加载数据通常不到一两秒钟，但其他外部API可能会更耗时。此外，我们需要一种方法来轻松检查HTTP GET请求是否失败。因此，我们将添加模拟来指定GET请求将如何响应。</p>
<h3 id="example-5-testing-asynchronous-code-successful-case">示例5 -测试异步代码(成功案例)</h3>
<p>组件的单元测试位于<em>src/components/_ _ tests _ _/app . spec . js</em>文件中。</p>
<p>首先，我们需要<code>import</code>Axios库:</p>
<div class="codehilite"><pre><span/><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">beforeEach</span><span class="p">,</span><span class="w"> </span><span class="nx">afterEach</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'vitest'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">,</span><span class="w"> </span><span class="nx">mount</span><span class="p">,</span><span class="w"> </span><span class="nx">flushPromises</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'@vue/test-utils'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'../../App.vue'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'axios'</span><span class="w"/>
</code></pre></div>

<p>但是，我们不想像在源代码中那样使用实际的Axios库(<em> App.vue </em>)。相反，我们想创建一个Axios库的<strong>模拟</strong>，这样我们就不会实际调用外部API:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// Mock the axios library</span><span class="w"/>
<span class="nx">vi</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s2">"axios"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span><span class="w"/>
<span class="w">    </span><span class="p">},</span><span class="w"/>
<span class="w">  </span><span class="p">};</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<p>这个代码块告诉Vitest应该模拟<code>axios</code>库中的<code>get()</code>方法。</p>
<p>在单元测试文件(<em>src/components/_ _ tests _ _/app . spec . js</em>)中，对于<code>App</code>组件，我们是:</p>
<ol>
<li>模拟成功的HTTP GET请求</li>
<li>模拟失败的HTTP GET请求</li>
</ol>
<p>首先，让我们处理HTTP GET请求成功的名义情况。</p>
<div class="codehilite"><pre><span/><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'Implementation Test for App.vue with Successful HTTP GET'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"/>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">responseGet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">'Chicago'</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nx">weather</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"/>
<span class="w">          </span><span class="p">{</span><span class="w"/>
<span class="w">            </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="s1">'Cloudy'</span><span class="p">,</span><span class="w"/>
<span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">'Cloudy with a chance of rain'</span><span class="w"/>
<span class="w">          </span><span class="p">}</span><span class="w"/>
<span class="w">        </span><span class="p">],</span><span class="w"/>
<span class="w">        </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">          </span><span class="nx">temp</span><span class="o">:</span><span class="w"> </span><span class="mf">56.3</span><span class="p">,</span><span class="w"/>
<span class="w">          </span><span class="nx">temp_min</span><span class="o">:</span><span class="w"> </span><span class="mf">53.8</span><span class="p">,</span><span class="w"/>
<span class="w">          </span><span class="nx">temp_max</span><span class="o">:</span><span class="w"> </span><span class="mf">58.6</span><span class="w"/>
<span class="w">        </span><span class="p">}</span><span class="w"/>
<span class="w">      </span><span class="p">}</span><span class="w"/>
<span class="w">    </span><span class="p">}</span><span class="w"/>

<span class="w">    </span><span class="c1">// Set the mock call to GET to return a successful GET response</span><span class="w"/>
<span class="w">    </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">responseGet</span><span class="p">)</span><span class="w"/>

<span class="w">    </span><span class="c1">// render the component</span><span class="w"/>
<span class="w">    </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">mockReset</span><span class="p">()</span><span class="w"/>
<span class="w">    </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">unmount</span><span class="p">()</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="p">...</span><span class="w"/>

<span class="p">})</span><span class="w"/>
</code></pre></div>

<h4 id="beforeeach-and-aftereach-blocks_1">每个块之前和每个块之后</h4>
<p>在<code>beforeEach()</code>函数中，我们设置当<code>axios.get()</code>被调用时应该发生的响应。响应是预先录制的天气数据，看起来类似于我们从开放天气中获得的数据，如果我们实际上发出请求的话。这一节的重点是:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// Set the mock call to GET to return a successful GET response</span><span class="w"/>
<span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">responseGet</span><span class="p">)</span><span class="w"/>
</code></pre></div>

<p>这一行是关键，因为它让Vitest知道，当在<code>App</code>组件中调用<code>axios.get()</code>时，它应该返回<code>responseGet</code>数组，而不是实际使用Axios进行HTTP GET调用。</p>
<p>单元测试套件的下一部分定义了<code>afterEach()</code>函数:</p>
<div class="codehilite"><pre><span/><code><span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">mockReset</span><span class="p">()</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">unmount</span><span class="p">()</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>在每个单元测试执行后调用的<code>afterEach()</code>函数清除单元测试执行期间创建的<code>axios.get()</code>的模拟。这种方法是一种很好的实践，可以在运行一个测试之后清理掉所有的模拟，这样任何后续的测试都可以从一个已知的状态开始。</p>
<h4 id="expects_2">预计</h4>
<p>现在我们可以定义单元测试了:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">(</span><span class="s1">'does load the weather data when a successful HTTP GET occurs'</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">searchCity</span><span class="p">(</span><span class="s1">'Chicago'</span><span class="p">)</span><span class="w"/>

<span class="w">  </span><span class="c1">// Wait until the DOM updates</span><span class="w"/>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">flushPromises</span><span class="p">()</span><span class="w"/>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">).</span><span class="nx">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">).</span><span class="nx">toBeCalledWith</span><span class="p">(</span><span class="nx">expect</span><span class="p">.</span><span class="nx">stringMatching</span><span class="p">(</span><span class="sr">/Chicago/</span><span class="p">))</span><span class="w"/>

<span class="w">  </span><span class="c1">// check that the user data is properly set</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">city</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Chicago'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">weatherSummary</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Cloudy'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">weatherDescription</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Cloudy with a chance of rain'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">currentTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">56.3</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">lowTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">53.8</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">highTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">58.6</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">validWeatherData</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>因为我们已经经历了定义模拟和呈现组件的步骤(通过<code>shallowMount()</code>),所以这个单元测试可以集中在执行检查上。</p>
<p>单元测试通过调用<code>searchCity()</code>函数开始:</p>
<div class="codehilite"><pre><span/><code><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">searchCity</span><span class="p">(</span><span class="s1">'Chicago'</span><span class="p">)</span><span class="w"/>
</code></pre></div>

<p>为了确保<code>searchCity()</code>函数在<code>App</code>组件中引起预期的更新，测试需要等待所有的承诺被解析，并且等待DOM更新生效:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// Wait until all Promises are resolved and the DOM updates</span><span class="w"/>
<span class="k">await</span><span class="w"> </span><span class="nx">flushPromises</span><span class="p">()</span><span class="w"/>
</code></pre></div>

<p>我们检查了<code>axios.get()</code>只被调用了一次，并且HTTP GET调用包含了正确的城市名:</p>
<div class="codehilite"><pre><span/><code><span class="nx">expect</span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">).</span><span class="nx">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">).</span><span class="nx">toBeCalledWith</span><span class="p">(</span><span class="nx">expect</span><span class="p">.</span><span class="nx">stringMatching</span><span class="p">(</span><span class="sr">/Chicago/</span><span class="p">))</span><span class="w"/>
</code></pre></div>

<p>为了非常彻底，天气数据还检查了在这个单元测试中呈现的<code>App</code>组件的实例，以确保它与从<code>axios.get()</code>的模拟返回的预先封装的数据相匹配:</p>
<div class="codehilite"><pre><span/><code><span class="c1">// check that the user data is properly set</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">city</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Chicago'</span><span class="p">)</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">weatherSummary</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Cloudy'</span><span class="p">)</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">weatherDescription</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Cloudy with a chance of rain'</span><span class="p">)</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">currentTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">56.3</span><span class="p">)</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">lowTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">53.8</span><span class="p">)</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">highTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">58.6</span><span class="p">)</span><span class="w"/>
<span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">validWeatherData</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"/>
</code></pre></div>

<h3 id="example-6-testing-asynchronous-code-failure-case">示例6 -测试异步代码(失败案例)</h3>
<p>虽然测试事情是否按预期进行很好，但是检查我们的软件如何对负面情况做出反应也很重要。记住这一点，让我们创建第二个单元测试套件来检查失败的HTTP GET请求:</p>
<div class="codehilite"><pre><span/><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'Implementation Test for App.vue with Failed HTTP GET'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span><span class="w"/>
</code></pre></div>

<blockquote>
<p>在一个单元测试文件(<em> .spec.js </em>)中包含多个单元测试套件没有任何问题。</p>
<p>因为模拟是在<code>beforeEach()</code>函数中创建的，所以对于成功和失败的HTTP GET响应，需要有不同的<code>beforeEach()</code>实现的独立单元测试套件。</p>
</blockquote>
<h4 id="beforeeach-and-aftereach-blocks_2">每个块之前和每个块之后</h4>
<p>这个单元测试套件中的<code>beforeEach()</code>函数非常不同:</p>
<div class="codehilite"><pre><span/><code><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// Set the mock call to GET to return a failed GET request</span><span class="w"/>
<span class="w">  </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'BAD REQUEST'</span><span class="p">))</span><span class="w"/>

<span class="w">  </span><span class="c1">// Render the component</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>我们现在返回的不是从<code>axios.get()</code>调用返回的响应，而是一个失败的<code>Promise</code>对象，其响应为“错误请求”。</p>
<p>这个单元测试套件的<code>afterEach()</code>函数与另一个单元测试套件相同:</p>
<div class="codehilite"><pre><span/><code><span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">mockReset</span><span class="p">()</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">unmount</span><span class="p">()</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<h4 id="expects_3">预计</h4>
<p>下面是测试失败的HTTP GET请求的单元测试函数:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">(</span><span class="s1">'does not load the weather data when a failed HTTP GET occurs'</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">searchCity</span><span class="p">(</span><span class="s1">'Chicago'</span><span class="p">)</span><span class="w"/>

<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">).</span><span class="nx">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">).</span><span class="nx">toBeCalledWith</span><span class="p">(</span><span class="nx">expect</span><span class="p">.</span><span class="nx">stringMatching</span><span class="p">(</span><span class="sr">/Chicago/</span><span class="p">))</span><span class="w"/>

<span class="w">  </span><span class="c1">// Wait until the DOM updates</span><span class="w"/>
<span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">flushPromises</span><span class="p">()</span><span class="w"/>

<span class="w">  </span><span class="c1">// Check that there is no user data loaded when the GET request fails</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">city</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="sr">/^$/</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">weatherSummary</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="sr">/^$/</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">weatherDescription</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="sr">/^$/</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">currentTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">lowTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">weatherData</span><span class="p">.</span><span class="nx">highTemperature</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">validWeatherData</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"/>

<span class="w">  </span><span class="c1">// check that the banner message indicates failure</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">messageToDisplay</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'ERROR! Unable to retrieve weather data for Chicago!'</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="nx">expect</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">vm</span><span class="p">.</span><span class="nx">messageType</span><span class="p">).</span><span class="nx">toMatch</span><span class="p">(</span><span class="s1">'Error'</span><span class="p">)</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>就像在前面的单元测试套件中一样，我们检查只有一个<code>axios.get()</code>实例被调用，然后检查没有天气数据被加载到<code>App</code>组件中。</p>
<h2 id="code-coverage">代码覆盖率</h2>
<p>在开发单元测试时，了解实际测试了多少源代码是件好事。这个概念被称为代码覆盖率。</p>
<blockquote>
<p>我需要非常明确的是，拥有一组覆盖100%源代码的单元测试并不意味着代码得到了正确的测试。</p>
<p>这个度量意味着有很多单元测试，并且在开发单元测试上投入了大量的精力。单元测试的质量仍然需要通过代码检查来检查。</p>
<p>另一个极端是最小集合(或者没有！)是一个非常糟糕的指标。</p>
</blockquote>
<p>Vitest通过使用<code>--coverage</code>标志来提供代码覆盖率。</p>
<p>为了方便地运行带有覆盖率结果的Vitest，我喜欢在<em> package.json </em>的<code>script</code>部分包含以下项目:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vue-weather-app"</span><span class="p">,</span><span class="w"/>
<span class="w">  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w"/>
<span class="w">  </span><span class="nt">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="err">...</span><span class="w"/>
<span class="w">    </span><span class="nt">"test:unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vitest run --environment jsdom"</span><span class="p">,</span><span class="w"/>
<span class="w">    </span><span class="nt">"test:coverage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vitest run --environment jsdom --coverage"</span><span class="p">,</span><span class="w"/>
<span class="w">    </span><span class="nt">"test:ui"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vitest --environment jsdom --coverage --ui"</span><span class="w"/>
<span class="w">  </span><span class="p">},</span><span class="w"/>
<span class="w">  </span><span class="err">...</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<p>运行<code>npm run test:unit</code>时，执行单元测试:</p>
<div class="codehilite"><pre><span/><code>$ npm run test:unit
...
 ✓ src/components/__tests__/WeatherBanner.spec.js <span class="o">(</span><span class="m">5</span><span class="o">)</span>
 ✓ src/components/__tests__/WeatherSearch.spec.js <span class="o">(</span><span class="m">5</span><span class="o">)</span>
 ✓ src/components/__tests__/WeatherFooter.spec.js <span class="o">(</span><span class="m">1</span><span class="o">)</span>
 ✓ src/components/__tests__/WeatherHeader.spec.js <span class="o">(</span><span class="m">1</span><span class="o">)</span>
 ✓ src/components/__tests__/WeatherResult.spec.js <span class="o">(</span><span class="m">3</span><span class="o">)</span>
 ✓ src/components/__tests__/App.spec.js <span class="o">(</span><span class="m">7</span><span class="o">)</span>

Test Files  <span class="m">6</span> passed <span class="o">(</span><span class="m">6</span><span class="o">)</span>
     Tests  <span class="m">22</span> passed <span class="o">(</span><span class="m">22</span><span class="o">)</span>
      Time  <span class="m">2</span>.81s <span class="o">(</span><span class="k">in</span> thread 536ms, <span class="m">524</span>.89%<span class="o">)</span>
</code></pre></div>

<p>当<code>npm run test:coverage</code>运行时，执行单元测试并报告覆盖率:</p>
<div class="codehilite"><pre><span/><code>$ npm run test:coverage
...
Test Files  <span class="m">6</span> passed <span class="o">(</span><span class="m">6</span><span class="o">)</span>
     Tests  <span class="m">22</span> passed <span class="o">(</span><span class="m">22</span><span class="o">)</span>
      Time  <span class="m">3</span>.38s <span class="o">(</span><span class="k">in</span> thread 660ms, <span class="m">512</span>.10%<span class="o">)</span>

--------------------<span class="p">|</span>---------<span class="p">|</span>----------<span class="p">|</span>---------<span class="p">|</span>---------<span class="p">|</span>-------------------
File                <span class="p">|</span> % Stmts <span class="p">|</span> % Branch <span class="p">|</span> % Funcs <span class="p">|</span> % Lines <span class="p">|</span> Uncovered Line <span class="c1">#s</span>
--------------------<span class="p">|</span>---------<span class="p">|</span>----------<span class="p">|</span>---------<span class="p">|</span>---------<span class="p">|</span>-------------------
All files           <span class="p">|</span>   <span class="m">99</span>.15 <span class="p">|</span>    <span class="m">96</span>.55 <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>   <span class="m">99</span>.15 <span class="p">|</span>
 src                <span class="p">|</span>   <span class="m">97</span>.31 <span class="p">|</span>    <span class="m">85</span>.71 <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>   <span class="m">97</span>.31 <span class="p">|</span>
  App.vue           <span class="p">|</span>   <span class="m">97</span>.31 <span class="p">|</span>    <span class="m">85</span>.71 <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>   <span class="m">97</span>.31 <span class="p">|</span> <span class="m">60</span>-63
 src/components     <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>      <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>
  WeatherBanner.vue <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>      <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>
  WeatherFooter.vue <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>      <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>
  WeatherHeader.vue <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>      <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>
  WeatherResult.vue <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>      <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>
  WeatherSearch.vue <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>      <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>     <span class="m">100</span> <span class="p">|</span>
--------------------<span class="p">|</span>---------<span class="p">|</span>----------<span class="p">|</span>---------<span class="p">|</span>---------<span class="p">|</span>-------------------
</code></pre></div>

<p><code>npm run test:ui</code>将在您的默认web浏览器中加载测试和覆盖结果，这可以方便地直观地看到测试覆盖缺失的地方。</p>
<h2 id="unit-test-structure">单元测试结构</h2>
<p>在浏览了许多不同的单元测试文件之后，我推荐Vue组件的单元测试文件采用以下结构:</p>
<div class="codehilite"><pre><span/><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="p">,</span><span class="w"> </span><span class="nx">beforeEach</span><span class="p">,</span><span class="w"> </span><span class="nx">afterEach</span><span class="p">,</span><span class="w"> </span><span class="nx">vi</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'vitest'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">shallowMount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'@vue/test-utils'</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="nx">App</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'@/App.vue'</span><span class="w">  </span><span class="c1">// Import Vue component to test</span><span class="w"/>
<span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'axios'</span><span class="w">    </span><span class="c1">// Import libraries to mock</span><span class="w"/>

<span class="c1">// Mock the axios library</span><span class="w"/>
<span class="nx">vi</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s2">"axios"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">      </span><span class="nx">get</span><span class="o">:</span><span class="w"> </span><span class="nx">vi</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span><span class="w"/>
<span class="w">    </span><span class="p">},</span><span class="w"/>
<span class="w">  </span><span class="p">};</span><span class="w"/>
<span class="p">});</span><span class="w"/>


<span class="nx">describe</span><span class="p">(</span><span class="s1">'Tests for the ... Component'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="w"/>

<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="c1">// set any initial data and create the mocks of libraries</span><span class="w"/>

<span class="w">    </span><span class="c1">// render the component</span><span class="w"/>
<span class="w">    </span><span class="nx">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">shallowMount</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="nx">afterEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">.</span><span class="nx">mockReset</span><span class="p">()</span><span class="w"/>
<span class="w">    </span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">unmount</span><span class="p">()</span><span class="w"/>
<span class="w">  </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'check successful events'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'check failure events'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">})</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>关键项目:</p>
<ul>
<li>每个单元测试套件都有一组相关的单元测试</li>
<li>利用<code>beforeEach()</code>和<code>afterEach()</code>函数创建独立的单元测试函数</li>
<li>创建测试过的Vue组件中使用的任何库的模拟</li>
<li>在<code>beforeEach()</code>函数中呈现组件，并在单元测试函数中更新属性数据</li>
<li>利用<code>shallowMount()</code>而不是<code>mount()</code>来集中测试单个组件</li>
</ul>
<h2 id="conclusion">结论</h2>
<p>本文提供了单元测试Vue组件的指南，重点关注:</p>
<ol>
<li>为什么应该编写单元测试</li>
<li>你应该(和不应该)单元测试什么</li>
<li>如何编写单元测试</li>
</ol>
<p>简单地说，当考虑测试什么时，重点测试输入和输出(实际结果)，而不是底层的业务逻辑(结果是如何产生的)。记住这一点，花一两分钟时间再次回顾示例，记下测试的输入和输出。</p>
<blockquote>
<p>同样，如果你有兴趣了解更多关于Vue的知识，可以看看我的课程:<a href="/courses/learn-vue/">通过构建和部署CRUD应用</a>来学习Vue。</p>
</blockquote>
<hr/>
<p>这是测试Vue应用的两部分系列的第一部分:</p>
<ol>
<li><a href="/blog/vue-unit-testing/">单元测试Vue组件指南</a>(本文！)</li>
<li><a href="/blog/vue-pinia-testing/">测试Vue中的Pinia数据存储</a></li>
</ol>
  </div>

  </div>    
</body>
</html>