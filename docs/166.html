<html>
<head>
<title>Modern Front-End Testing with Cypress </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Cypress进行现代前端测试</h1>
<blockquote>原文：<a href="https://testdriven.io/blog/modern-frontend-testing-with-cypress/#0001-01-01">https://testdriven.io/blog/modern-frontend-testing-with-cypress/#0001-01-01</a></blockquote><div><div class="blog-content long-content" data-local-nav-source="">
    <p>Cypress是一个现代的web自动化测试框架，旨在简化浏览器测试。虽然它以Selenium替代品而闻名，但它不仅仅是一个端到端的测试自动化工具。Cypress是一个开发工具，是开发人员主动使用的，而不是专注于事后测试的非技术QA团队。</p>
<p>这篇文章着眼于当你用Flask和React构建一个应用程序时，如何将Cypress引入到你的测试驱动开发工作流中。</p>



<h2 id="sample-application">示例应用程序</h2>
<p>我们将使用Flask和React构建一个基本的todo应用程序，基于以下用户案例:</p>
<ol>
<li>作为用户，我可以看到列表中的所有待办事项</li>
<li>作为用户，我可以在列表中添加新的待办事项</li>
<li>作为用户，我可以切换每个待办事项的完成状态</li>
</ol>
<p>假设我们只关注客户端。换句话说，我们需要创建一个React todo应用程序，它通过AJAX与Flask后端交互，以获取和添加todo。如果您想继续编码，克隆出<a href="https://github.com/testdrivenio/flask-react-cypress"> flask-react-cypress </a> repo，然后将<a href="https://github.com/testdrivenio/flask-react-cypress/releases/tag/v1"> v1 </a>标记签出到主分支:</p>
<div class="codehilite"><pre><span/><code>$ git clone https://github.com/testdrivenio/flask-react-cypress --branch v1 --single-branch
$ <span class="nb">cd</span> flask-react-cypress
$ git checkout tags/v1 -b master
</code></pre></div>

<h2 id="workflow">工作流程</h2>
<p>这个工作流程关注于集成测试，其中开发和测试使用类似TDD的方法同时进行:</p>
<ol>
<li>将用户故事、需求和验收标准转化为部分测试规范</li>
<li>添加设备并切断网络呼叫</li>
<li>运行Cypress GUI，并在代码编辑器旁边打开它</li>
<li>使用<a href="https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Excluding-and-Including-Tests">。只需要</a>关注和迭代单个测试</li>
<li>确保测试失败</li>
<li>编码直到测试通过(红色、绿色、重构)</li>
<li>重复前面的三个步骤，直到所有测试都是绿色的</li>
<li>可选:通过删除网络存根将集成测试转换为端到端测试</li>
</ol>
<p>想看看这个工作流程的运行情况吗？查看<a href="https://www.youtube.com/watch?v=5sXulBZe25Q">我的Cypress工作流程</a>视频。</p>
<h2 id="initial-setup">初始设置</h2>
<p>步骤:</p>
<ol>
<li>将用户故事、需求和验收标准转化为部分测试规范</li>
<li>添加设备并切断网络呼叫</li>
<li>运行Cypress GUI，并在代码编辑器旁边打开它</li>
</ol>
<h3 id="create-partial-test-specs">创建部分测试规格</h3>
<p>将部分测试规范添加到名为<em>client/cypress/integration/todos . spec . js</em>的新文件中:</p>
<div class="codehilite"><pre><span/><code><span class="nx">describe</span><span class="p">(</span><span class="s1">'todo app'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'Todo List'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="p">});</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'should display the todo list'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{});</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'should add a new todo to the list'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{});</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'should toggle a todo correctly'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{});</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<p>然后，在一个<code>env</code>键下添加<code>baseUrl</code>和<code>serverUrl</code>——服务器端Flask应用程序的URL这样它就可以作为一个环境变量被<em> client/cypress.json </em>访问:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nt">"baseUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:3000"</span><span class="p">,</span><span class="w"/>
<span class="w">  </span><span class="nt">"env"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nt">"serverUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:5009"</span><span class="w"/>
<span class="w">  </span><span class="p">}</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<h3 id="add-fixtures">添加装置</h3>
<p>在我们处理请求之前，让我们添加fixture文件，这些文件将用于模拟从以下服务器端端点返回的数据:</p>
<ol>
<li>获取-/待办事项-获取所有待办事项</li>
<li>发布/待办事项-添加待办事项</li>
</ol>
<p><em>client/cypress/fixtures/todos/all _ before . JSON</em>:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nt">"todos"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nt">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"created_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mon, 28 Jan 2019 15:32:28 GMT"</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"go for a walk"</span><span class="w"/>
<span class="w">      </span><span class="p">},</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nt">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"created_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mon, 28 Jan 2019 15:32:28 GMT"</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"go for a short run"</span><span class="w"/>
<span class="w">      </span><span class="p">},</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nt">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"created_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mon, 28 Jan 2019 15:32:28 GMT"</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"clean the stereo"</span><span class="w"/>
<span class="w">      </span><span class="p">}</span><span class="w"/>
<span class="w">    </span><span class="p">]</span><span class="w"/>
<span class="w">  </span><span class="p">},</span><span class="w"/>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<p><em>client/cypress/fixtures/todos/add . JSON</em>:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make coffee"</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<p>这个最后的fixture是为了在添加一个新的todo后获取所有的todo。</p>
<p><em>client/cypress/fixtures/todos/all _ after . JSON</em>:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nt">"todos"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nt">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"created_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mon, 28 Jan 2019 15:32:28 GMT"</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"go for a walk"</span><span class="w"/>
<span class="w">      </span><span class="p">},</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nt">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"created_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mon, 28 Jan 2019 15:32:28 GMT"</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"go for a short run"</span><span class="w"/>
<span class="w">      </span><span class="p">},</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nt">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"created_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mon, 28 Jan 2019 15:32:28 GMT"</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"clean the stereo"</span><span class="w"/>
<span class="w">      </span><span class="p">},</span><span class="w"/>
<span class="w">      </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nt">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"created_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mon, 28 Jan 2019 17:22:35 GMT"</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"/>
<span class="w">        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"drink a beverage"</span><span class="w"/>
<span class="w">      </span><span class="p">}</span><span class="w"/>
<span class="w">    </span><span class="p">]</span><span class="w"/>
<span class="w">  </span><span class="p">},</span><span class="w"/>
<span class="w">  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<p>然后，将<a href="https://docs.cypress.io/guides/guides/network-requests.html#Fixtures">夹具</a>添加到测试规范中的<code>beforeEach</code>中:</p>
<div class="codehilite"><pre><span/><code><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// fixtures</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">fixture</span><span class="p">(</span><span class="s1">'todos/all_before.json'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'todosJSON'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">fixture</span><span class="p">(</span><span class="s1">'todos/add.json'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'addTodoJSON'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">fixture</span><span class="p">(</span><span class="s1">'todos/all_after.json'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'updatedJSON'</span><span class="p">);</span><span class="w"/>

<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'Todo List'</span><span class="p">);</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<h3 id="stub-network-calls">存根网络呼叫</h3>
<p>再次更新<code>beforeEach</code>，添加一个<a href="https://docs.cypress.io/guides/guides/network-requests.html#Stubbing">存根</a>和一个显式<a href="https://docs.cypress.io/guides/guides/network-requests.html#Waiting">等待</a>:</p>
<div class="codehilite"><pre><span/><code><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// fixtures</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">fixture</span><span class="p">(</span><span class="s1">'todos/all_before.json'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'todosJSON'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">fixture</span><span class="p">(</span><span class="s1">'todos/add.json'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'addTodoJSON'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">fixture</span><span class="p">(</span><span class="s1">'todos/all_after.json'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'updatedJSON'</span><span class="p">);</span><span class="w"/>

<span class="w">  </span><span class="c1">// network stub</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">server</span><span class="p">();</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">serverUrl</span><span class="si">}</span><span class="sb">/todos`</span><span class="p">,</span><span class="w"> </span><span class="s1">'@todosJSON'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">);</span><span class="w"/>


<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">wait</span><span class="p">(</span><span class="s1">'@getAllTodos'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'Todo List'</span><span class="p">);</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<p>将环境变量<code>serverUrl</code>的值赋给一个变量:</p>
<div class="codehilite"><pre><span/><code><span class="kd">const</span><span class="w"> </span><span class="nx">serverUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">(</span><span class="s1">'serverUrl'</span><span class="p">);</span><span class="w"/>
</code></pre></div>

<p>向<code>should add a new todo to the list</code>测试添加存根:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">(</span><span class="s1">'should add a new todo to the list'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// network stubs</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">server</span><span class="p">();</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">serverUrl</span><span class="si">}</span><span class="sb">/todos`</span><span class="p">,</span><span class="w"> </span><span class="s1">'@updatedJSON'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">serverUrl</span><span class="si">}</span><span class="sb">/todos`</span><span class="p">,</span><span class="w"> </span><span class="s1">'@addTodoJSON'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'addTodo'</span><span class="p">);</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<h3 id="open-cypress">开放的柏树</h3>
<p>在一个终端窗口中运行React应用:</p>
<div class="codehilite"><pre><span/><code>$ <span class="nb">cd</span> client
$ npm install
$ npm start
</code></pre></div>

<p>然后，在不同的窗口中打开Cypress GUI:</p>
<div class="codehilite"><pre><span/><code>$ <span class="nb">cd</span> client
$ ./node_modules/.bin/cypress open
</code></pre></div>

<p><img data-src="/static/images/blog/flask-react-cypress/test1.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/8acaf11dfeb5b435c307a45cc1686f87.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test1.png"/></p>
<p><img data-src="/static/images/blog/flask-react-cypress/test2.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/672b582c0a0b2222cfe83928c517d865.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test2.png"/></p>
<h2 id="development">发展</h2>
<p>步骤:</p>
<ol>
<li>使用<a href="https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests.html#Excluding-and-Including-Tests">。只需要</a>关注和迭代单个测试</li>
<li>确保测试失败</li>
<li>编码直到测试通过(红色、绿色、重构)</li>
<li>重复前面的三个步骤，直到所有测试都是绿色的</li>
</ol>
<h3 id="displays-all-todos">显示所有待办事项</h3>
<p>更新测试:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'should display the todo list'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">its</span><span class="p">(</span><span class="s1">'length'</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">'eq'</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'go for a walk'</span><span class="p">);</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<p><img data-src="/static/images/blog/flask-react-cypress/test3.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/1738edcdc08a2ee9e539a5d537005e8b.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test3.png"/></p>
<p>然后，更新<code>App</code>组件:</p>
<div class="codehilite"><pre><span/><code><span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span> <span class="n">Component</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">axios</span> <span class="kn">from</span> <span class="s1">'axios'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">App</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
  <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">super</span><span class="p">();</span>
    <span class="n">this</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">todos</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">};</span>
  <span class="p">};</span>
  <span class="n">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">getTodos</span><span class="p">();</span>
  <span class="p">};</span>
  <span class="n">getTodos</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">axios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://localhost:5009/todos'</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">((</span><span class="n">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span> <span class="n">todos</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">todos</span> <span class="p">});</span> <span class="p">})</span>
    <span class="o">.</span><span class="n">catch</span><span class="p">((</span><span class="n">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"App"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">section</span> <span class="n">className</span><span class="o">=</span><span class="s2">"section"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"container"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"columns"</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"column is-half"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">h1</span> <span class="n">className</span><span class="o">=</span><span class="s2">"title is-1"</span><span class="o">&gt;</span><span class="n">Todo</span> <span class="n">List</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">hr</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">ul</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span>
                  <span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">todo</span> <span class="o">=&gt;</span>
                    <span class="o">&lt;</span><span class="n">li</span> <span class="n">key</span><span class="o">=</span><span class="p">{</span> <span class="n">todo</span><span class="o">.</span><span class="n">id</span> <span class="p">}</span> <span class="n">style</span><span class="o">=</span><span class="p">{{</span> <span class="n">fontSize</span><span class="p">:</span> <span class="s1">'1.5rem'</span> <span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span> <span class="n">todo</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                  <span class="p">)}</span>
                <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
              <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
          <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">section</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">App</span><span class="p">;</span>
</code></pre></div>

<p>在<code>componentDidMount</code>中，一个AJAX请求被发送到服务器端以获取所有的todos。当响应返回时，在成功处理程序中调用<code>setState</code>，该处理程序重新呈现组件，显示todo列表。</p>
<p>测试现在应该通过了:</p>
<p><img data-src="/static/images/blog/flask-react-cypress/test4.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/6ac48ee82966325fbb0440d19f3b1590.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test4.png"/></p>
<h3 id="add-a-todo">添加待办事项</h3>
<p>从通过的测试中删除<code>.only</code>，并更新下一个测试:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'should add a new todo to the list'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="c1">// network stubs</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">server</span><span class="p">();</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="s1">'http://localhost:5009/todos'</span><span class="p">,</span><span class="w"> </span><span class="s1">'@updatedJSON'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span><span class="w"> </span><span class="s1">'http://localhost:5009/todos'</span><span class="p">,</span><span class="w"> </span><span class="s1">'@addTodoJSON'</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'addTodo'</span><span class="p">);</span><span class="w"/>

<span class="w">  </span><span class="c1">// asserts</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'.input'</span><span class="p">).</span><span class="nx">type</span><span class="p">(</span><span class="s1">'drink a beverage'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'.button'</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'Submit'</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">wait</span><span class="p">(</span><span class="s1">'@addTodo'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">wait</span><span class="p">(</span><span class="s1">'@getAllTodos'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">its</span><span class="p">(</span><span class="s1">'length'</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">'eq'</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'go for a walk'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mf">3</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'drink a beverage'</span><span class="p">);</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<p><img data-src="/static/images/blog/flask-react-cypress/test5.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/ed1c812c3272671bb7c6c114d3c66e6d.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test5.png"/></p>
<p>再次更新组件:</p>
<div class="codehilite"><pre><span/><code><span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span> <span class="n">Component</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">axios</span> <span class="kn">from</span> <span class="s1">'axios'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">App</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
  <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">super</span><span class="p">();</span>
    <span class="n">this</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">todos</span><span class="p">:</span> <span class="p">[],</span>
      <span class="nb">input</span><span class="p">:</span> <span class="s1">''</span>
    <span class="p">};</span>
    <span class="n">this</span><span class="o">.</span><span class="n">handleChange</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">handleChange</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
    <span class="n">this</span><span class="o">.</span><span class="n">addTodo</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">addTodo</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="n">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">getTodos</span><span class="p">();</span>
  <span class="p">};</span>
  <span class="n">getTodos</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">axios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://localhost:5009/todos'</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">((</span><span class="n">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span> <span class="n">todos</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">todos</span> <span class="p">});</span> <span class="p">})</span>
    <span class="o">.</span><span class="n">catch</span><span class="p">((</span><span class="n">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="n">handleChange</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span> <span class="nb">input</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="n">addTodo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">axios</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">'http://localhost:5009/todos'</span><span class="p">,</span> <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">input</span> <span class="p">})</span>
      <span class="o">.</span><span class="n">then</span><span class="p">((</span><span class="n">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">getTodos</span><span class="p">();</span> <span class="p">})</span>
      <span class="o">.</span><span class="n">catch</span><span class="p">((</span><span class="n">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"App"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">section</span> <span class="n">className</span><span class="o">=</span><span class="s2">"section"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"container"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"columns"</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"column is-half"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">h1</span> <span class="n">className</span><span class="o">=</span><span class="s2">"title is-1"</span><span class="o">&gt;</span><span class="n">Todo</span> <span class="n">List</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">hr</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"content"</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"field has-addons"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"control"</span><span class="o">&gt;</span>
                      <span class="o">&lt;</span><span class="nb">input</span>
                        <span class="n">className</span><span class="o">=</span><span class="s2">"input"</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span>
                        <span class="n">placeholder</span><span class="o">=</span><span class="s2">"Add a todo"</span>
                        <span class="n">onChange</span><span class="o">=</span><span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">handleChange</span> <span class="p">}</span>
                      <span class="o">/&gt;</span>
                    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"control"</span> <span class="n">onClick</span><span class="o">=</span><span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">addTodo</span> <span class="p">}</span><span class="o">&gt;</span>
                      <span class="o">&lt;</span><span class="n">button</span> <span class="n">className</span><span class="o">=</span><span class="s2">"button is-info"</span><span class="o">&gt;</span><span class="n">Submit</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                  <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="n">ul</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">todo</span> <span class="o">=&gt;</span>
                      <span class="o">&lt;</span><span class="n">li</span> <span class="n">key</span><span class="o">=</span><span class="p">{</span> <span class="n">todo</span><span class="o">.</span><span class="n">id</span> <span class="p">}</span> <span class="n">style</span><span class="o">=</span><span class="p">{{</span> <span class="n">fontSize</span><span class="p">:</span> <span class="s1">'1.5rem'</span> <span class="p">}}</span><span class="o">&gt;</span><span class="p">{</span> <span class="n">todo</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                    <span class="p">)}</span>
                  <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
              <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
          <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">section</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">App</span><span class="p">;</span>
</code></pre></div>

<p>现在可以通过输入字段添加待办事项。每当输入值改变时，触发<code>onChange</code>事件，更新状态。单击submit按钮后，AJAX POST请求和输入字段中的值一起被发送到服务器。当返回成功的响应时，todo列表被更新。</p>
<p><img data-src="/static/images/blog/flask-react-cypress/test6.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/a0e59f5219070e7e597cf2152090f86f.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test6.png"/></p>
<h3 id="toggle-completed-state">切换完成状态</h3>
<p>测试:</p>
<div class="codehilite"><pre><span/><code><span class="nx">it</span><span class="p">.</span><span class="nx">only</span><span class="p">(</span><span class="s1">'should toggle a todo correctly'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'go for a walk'</span><span class="p">)</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">'have.css'</span><span class="p">,</span><span class="w"> </span><span class="s1">'text-decoration'</span><span class="p">,</span><span class="w"> </span><span class="s1">'none solid rgb(74, 74, 74)'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'go for a walk'</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span><span class="w"/>
<span class="w">  </span><span class="nx">cy</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'go for a walk'</span><span class="p">)</span><span class="w"/>
<span class="w">    </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">'have.css'</span><span class="p">,</span><span class="w"> </span><span class="s1">'text-decoration'</span><span class="p">,</span><span class="w"> </span><span class="s1">'line-through solid rgb(74, 74, 74)'</span><span class="p">);</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<p><img data-src="/static/images/blog/flask-react-cypress/test7.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/3165ce273247d62502f75b20d30f5121.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test7.png"/></p>
<p>组件:</p>
<div class="codehilite"><pre><span/><code><span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span> <span class="n">Component</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">axios</span> <span class="kn">from</span> <span class="s1">'axios'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">App</span> <span class="n">extends</span> <span class="n">Component</span> <span class="p">{</span>
  <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">super</span><span class="p">();</span>
    <span class="n">this</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">todos</span><span class="p">:</span> <span class="p">[],</span>
      <span class="nb">input</span><span class="p">:</span> <span class="s1">''</span>
    <span class="p">};</span>
    <span class="n">this</span><span class="o">.</span><span class="n">handleChange</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">handleChange</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
    <span class="n">this</span><span class="o">.</span><span class="n">addTodo</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">addTodo</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
    <span class="n">this</span><span class="o">.</span><span class="n">handleClick</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">handleClick</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="n">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">getTodos</span><span class="p">();</span>
  <span class="p">};</span>
  <span class="n">getTodos</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">axios</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://localhost:5009/todos'</span><span class="p">)</span>
    <span class="o">.</span><span class="n">then</span><span class="p">((</span><span class="n">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span> <span class="n">todos</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">todos</span> <span class="p">});</span> <span class="p">})</span>
    <span class="o">.</span><span class="n">catch</span><span class="p">((</span><span class="n">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="n">handleChange</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span> <span class="nb">input</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">value</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="n">addTodo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">axios</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">'http://localhost:5009/todos'</span><span class="p">,</span> <span class="p">{</span> <span class="n">name</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">input</span> <span class="p">})</span>
      <span class="o">.</span><span class="n">then</span><span class="p">((</span><span class="n">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">getTodos</span><span class="p">();</span> <span class="p">})</span>
      <span class="o">.</span><span class="n">catch</span><span class="p">((</span><span class="n">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="n">handleClick</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">setState</span> <span class="p">({</span>
      <span class="n">todos</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">todo</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">todo</span><span class="o">.</span><span class="n">id</span> <span class="o">===</span> <span class="nb">id</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">todo</span><span class="o">.</span><span class="n">complete</span> <span class="o">=</span> <span class="err">!</span><span class="n">todo</span><span class="o">.</span><span class="n">complete</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">todo</span><span class="p">;</span>
      <span class="p">}),</span>
    <span class="p">});</span>
  <span class="p">};</span>
  <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"App"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">section</span> <span class="n">className</span><span class="o">=</span><span class="s2">"section"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"container"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"columns"</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"column is-half"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">h1</span> <span class="n">className</span><span class="o">=</span><span class="s2">"title is-1"</span><span class="o">&gt;</span><span class="n">Todo</span> <span class="n">List</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">hr</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"content"</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"field has-addons"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"control"</span><span class="o">&gt;</span>
                      <span class="o">&lt;</span><span class="nb">input</span>
                        <span class="n">className</span><span class="o">=</span><span class="s2">"input"</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span>
                        <span class="n">placeholder</span><span class="o">=</span><span class="s2">"Add a todo"</span>
                        <span class="n">onChange</span><span class="o">=</span><span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">handleChange</span> <span class="p">}</span>
                      <span class="o">/&gt;</span>
                    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">div</span> <span class="n">className</span><span class="o">=</span><span class="s2">"control"</span> <span class="n">onClick</span><span class="o">=</span><span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">addTodo</span> <span class="p">}</span><span class="o">&gt;</span>
                      <span class="o">&lt;</span><span class="n">button</span> <span class="n">className</span><span class="o">=</span><span class="s2">"button is-info"</span><span class="o">&gt;</span><span class="n">Submit</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                  <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                  <span class="o">&lt;</span><span class="n">ul</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">todos</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">todo</span> <span class="o">=&gt;</span>
                      <span class="o">&lt;</span><span class="n">li</span>
                        <span class="n">key</span><span class="o">=</span><span class="p">{</span> <span class="n">todo</span><span class="o">.</span><span class="n">id</span> <span class="p">}</span>
                        <span class="n">style</span><span class="o">=</span><span class="p">{{</span>
                          <span class="n">textDecoration</span><span class="p">:</span> <span class="n">todo</span><span class="o">.</span><span class="n">complete</span> <span class="err">?</span> <span class="s1">'line-through'</span> <span class="p">:</span> <span class="s1">'none'</span><span class="p">,</span>
                          <span class="n">fontSize</span><span class="p">:</span> <span class="s1">'1.5rem'</span><span class="p">,</span>
                        <span class="p">}}</span>
                        <span class="n">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="n">this</span><span class="o">.</span><span class="n">handleClick</span><span class="p">(</span><span class="n">todo</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span>
                      <span class="o">&gt;</span>
                        <span class="p">{</span> <span class="n">todo</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
                      <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                    <span class="p">)}</span>
                  <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
              <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
          <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">section</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">App</span><span class="p">;</span>
</code></pre></div>

<p>当todo <code>li</code>被点击时，<code>handleClick</code>被触发，然后切换<code>todo.complete</code>布尔值的值。如果布尔值为<code>true</code>，那么待办事项的<code>text-direction</code>将被设置为<code>line-through</code>。</p>
<p><img data-src="/static/images/blog/flask-react-cypress/test8.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/71712a7161b71b6005002fbacc85fc92.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test8.png"/></p>
<p>从最终测试中移除<code>.only</code>。</p>
<h2 id="end-to-end-tests">端到端测试</h2>
<p>最后，让我们通过移除网络存根和设备，将集成测试转换为端到端测试。我们也会做一些重构。</p>
<p><em>client/cypress/integration/todos-e2e . spec . js</em>:</p>
<div class="codehilite"><pre><span/><code><span class="kd">const</span><span class="w"> </span><span class="nx">serverUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">(</span><span class="s1">'serverUrl'</span><span class="p">);</span><span class="w"/>

<span class="nx">describe</span><span class="p">(</span><span class="s1">'todo app - e2e'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="c1">// network call</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">server</span><span class="p">();</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">route</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">serverUrl</span><span class="si">}</span><span class="sb">/todos`</span><span class="p">).</span><span class="kr">as</span><span class="p">(</span><span class="s1">'getAllTodos'</span><span class="p">);</span><span class="w"/>

<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">wait</span><span class="p">(</span><span class="s1">'@getAllTodos'</span><span class="p">);</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'Todo List'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="p">});</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'should display the todo list'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">its</span><span class="p">(</span><span class="s1">'length'</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="s1">'eq'</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'walk'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="p">});</span><span class="w"/>

<span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">'should toggle a todo correctly'</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="w"/>
<span class="w">      </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span><span class="w"/>
<span class="w">      </span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"/>
<span class="w">      </span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'walk'</span><span class="p">)</span><span class="w"/>
<span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">'have.css'</span><span class="p">,</span><span class="w"> </span><span class="s1">'text-decoration'</span><span class="p">,</span><span class="w"> </span><span class="s1">'none solid rgb(74, 74, 74)'</span><span class="p">);</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'walk'</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span><span class="w"/>
<span class="w">    </span><span class="nx">cy</span><span class="w"/>
<span class="w">      </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'li'</span><span class="p">)</span><span class="w"/>
<span class="w">      </span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="s1">'walk'</span><span class="p">)</span><span class="w"/>
<span class="w">      </span><span class="p">.</span><span class="nx">should</span><span class="p">(</span><span class="s1">'have.css'</span><span class="p">,</span><span class="w"> </span><span class="s1">'text-decoration'</span><span class="p">,</span><span class="w"> </span><span class="s1">'line-through solid rgb(74, 74, 74)'</span><span class="p">);</span><span class="w"/>
<span class="w">  </span><span class="p">});</span><span class="w"/>
<span class="p">});</span><span class="w"/>
</code></pre></div>

<p>在运行这些之前，您需要启动服务器端的Flask应用程序和Postgres，并创建和播种数据库:</p>
<div class="codehilite"><pre><span/><code>$ <span class="nb">cd</span> server
$ docker-compose up -d --build
$ docker-compose <span class="nb">exec</span> web python manage.py recreate_db
$ docker-compose <span class="nb">exec</span> web python manage.py seed_db
</code></pre></div>

<p><img data-src="/static/images/blog/flask-react-cypress/test9.png" loading="lazy" class="lazyload" alt="cypress gui" src="../Images/c276a03d214b45299b0ed52754f946b7.png" data-original-src="https://testdriven.io/static/images/blog/flask-react-cypress/test9.png"/></p>
<p>现在，由于完整的端到端测试需要运行Flask应用程序，您可能不希望在开发时在本地运行它们。要忽略它们，将<code>ignoreTestFiles</code> <a href="https://docs.cypress.io/guides/references/configuration.html#Global">配置变量</a>添加到<em> cypress.json </em>文件中:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nt">"baseUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:3000"</span><span class="p">,</span><span class="w"/>
<span class="w">  </span><span class="nt">"env"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nt">"serverUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:5009"</span><span class="w"/>
<span class="w">  </span><span class="p">},</span><span class="w"/>
<span class="w">  </span><span class="nt">"ignoreTestFiles"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*e2e*"</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<p>然后，您可以通过使用不同的配置文件在其他环境中运行它们。</p>
<h2 id="conclusion">结论</h2>
<p>Cypress是一个强大的工具，它使设置、编写、运行和调试测试变得容易。希望这篇文章向您展示了将Cypress整合到您的开发工作流中是多么容易。</p>
<p>资源:</p>
<ol>
<li><a href="https://github.com/testdrivenio/flask-react-cypress">最终代码</a></li>
<li><a href="https://www.youtube.com/watch?v=5sXulBZe25Q">我的柏树工作流程</a>视频</li>
<li><a href="https://mherman.org/presentations/cypress/">柏树助你获得更好的睡眠</a>幻灯片</li>
<li><a href="https://www.cypress.io/blog/2018/04/02/sliding-down-the-testing-pyramid">滑下测试金字塔</a>博文</li>
</ol>
  </div>

  </div>    
</body>
</html>