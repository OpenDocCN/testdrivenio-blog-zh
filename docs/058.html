<html>
<head>
<title>Permissions in Django </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Django的权限</h1>
<blockquote>原文：<a href="https://testdriven.io/blog/django-permissions/#0001-01-01">https://testdriven.io/blog/django-permissions/#0001-01-01</a></blockquote><div><div class="blog-content long-content" data-local-nav-source="">
    <p>Django自带强大的<a href="https://docs.djangoproject.com/en/4.0/topics/auth/default/#permissions-and-authorization">权限</a>系统。</p>
<p>在本文中，我们将了解如何为用户和组分配权限，以便授权他们执行特定的操作。</p>



<h2 id="objectives">目标</h2>
<p>完成本文后，您将能够:</p>
<ol>
<li>解释Django的权限和组是如何工作的</li>
<li>利用Django内置许可系统的力量</li>
</ol>
<h2 id="authentication-vs-authorization">身份验证与授权</h2>
<p>这篇文章是关于授权的。</p>
<ul>
<li><strong>认证</strong>是确认用户是否有权访问系统的过程。通常，用户名/电子邮件和密码用于验证用户。</li>
<li><strong>授权:</strong>与“认证”用户在系统中可以做什么有关。</li>
</ul>
<p>换句话说，认证回答了“你是谁？”而授权回答‘你能做什么？’。</p>
<h2 id="user-level-permissions">用户级权限</h2>
<p>当<code>django.contrib.auth</code>被添加到<em> settings.py </em>文件中的<code>INSTALLED_APPS</code>设置中时，Django <a href="https://docs.djangoproject.com/en/4.0/topics/auth/default/#default-permissions">自动</a>为创建的每个Django模型创建<code>add</code>、<code>change</code>、<code>delete</code>和<code>view</code>权限。</p>
<p>Django中的权限遵循以下命名顺序:</p>
<p><code>{app}.{action}_{model_name}</code></p>
<p>注意事项:</p>
<ul>
<li><code>app</code>是相关模型所在的Django应用的名称</li>
<li><code>action</code>:是<code>add</code>、<code>change</code>、<code>delete</code>还是<code>view</code></li>
<li><code>model_name</code>:小写的型号名称</li>
</ul>
<p>让我们假设我们在一个名为“博客”的应用程序中有以下模型:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
</code></pre></div>

<p>默认情况下，Django将创建以下权限:</p>
<ol>
<li><code>blog.add_post</code></li>
<li><code>blog.change_post</code></li>
<li><code>blog.delete_post</code></li>
<li><code>blog.view_post</code></li>
</ol>
<p>然后，您可以检查用户(通过Django用户对象)是否拥有使用<code>has_perm()</code>方法的权限:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Permission</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>

<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
<span class="n">post_permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">perm</span><span class="o">.</span><span class="n">codename</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">post_permission</span><span class="p">])</span>
<span class="c1"># =&gt; ['add_post', 'change_post', 'delete_post', 'view_post']</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="601405131420151305124e030f0d">[email protected]</a>"</span><span class="p">)</span>

<span class="c1"># Check if the user has permissions already</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.view_post"</span><span class="p">))</span>
<span class="c1"># =&gt; False</span>

<span class="c1"># To add permissions</span>
<span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">post_permission</span><span class="p">:</span>
    <span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.view_post"</span><span class="p">))</span>
<span class="c1"># =&gt; False</span>
<span class="c1"># Why? This is because Django's permissions do not take</span>
<span class="c1"># effect until you allocate a new instance of the user.</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="s2">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ccb8a9bfb88cb9bfa9bee2afa3a1">[email protected]</a>"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.view_post"</span><span class="p">))</span>
<span class="c1"># =&gt; True</span>
</code></pre></div>

<p>超级用户将始终拥有设置为<code>True</code>的权限，即使该权限不存在:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="n">superuser</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_superuser</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="s2">"super"</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7d0e080d180f3d09180e09531e1210">[email protected]</a>"</span>
<span class="p">)</span>

<span class="c1"># Output will be true</span>
<span class="nb">print</span><span class="p">(</span><span class="n">superuser</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.view_post"</span><span class="p">))</span>

<span class="c1"># Output will be true even if the permission does not exists</span>
<span class="nb">print</span><span class="p">(</span><span class="n">superuser</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"foo.add_bar"</span><span class="p">))</span>
</code></pre></div>

<blockquote>
<p>超级用户是Django中拥有系统中所有权限的用户类型。无论是自定义权限还是Django创建的权限，超级用户都可以访问每一个权限。</p>
<p>staff用户就像系统中的任何其他用户一样，但是具有能够访问Django管理界面的额外优势。Django管理界面只对超级用户和职员用户开放。</p>
</blockquote>
<h2 id="group-level-permissions">组级权限</h2>
<p>每次都必须给用户分配权限，这很繁琐，而且不可伸缩。在某些情况下，您可能希望向一组用户添加新的权限。这里是Django组织发挥作用的地方。</p>
<p>什么是团体？</p>
<ul>
<li>英语定义:组是被分类在一起的一组对象。</li>
<li>Django定义:组模型是一种对用户进行分类的通用方法，因此您可以对这些用户应用权限或其他标签。用户可以属于任意数量的组。</li>
</ul>
<p>使用Django，您可以创建组来对用户进行分类，并为每个组分配权限，因此在创建用户时，您可以将用户分配到一个组，反过来，用户拥有该组的所有权限。</p>
<p>要创建一个组，您需要来自<code>django.contrib.auth.models</code>的<code>Group</code>模型。</p>
<p>让我们为以下角色创建组:</p>
<ul>
<li><code>Author</code>:可以查看和添加帖子</li>
<li><code>Editor</code>:可以查看、添加、编辑帖子</li>
<li><code>Publisher</code>:可以查看、添加、编辑、删除帖子</li>
</ul>
<p>代码:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">Group</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">Permission</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>

<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="n">author_group</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Author"</span><span class="p">)</span>
<span class="n">editor_group</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Editor"</span><span class="p">)</span>
<span class="n">publisher_group</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Publisher"</span><span class="p">)</span>

<span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
<span class="n">post_permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">perm</span><span class="o">.</span><span class="n">codename</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">post_permission</span><span class="p">])</span>
<span class="c1"># =&gt; ['add_post', 'change_post', 'delete_post', 'view_post']</span>

<span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">post_permission</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">perm</span><span class="o">.</span><span class="n">codename</span> <span class="o">==</span> <span class="s2">"delete_post"</span><span class="p">:</span>
        <span class="n">publisher_group</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">perm</span><span class="o">.</span><span class="n">codename</span> <span class="o">==</span> <span class="s2">"change_post"</span><span class="p">:</span>
        <span class="n">editor_group</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">publisher_group</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">author_group</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">editor_group</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">publisher_group</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">"test"</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">author_group</span><span class="p">)</span>  <span class="c1"># Add the user to the Author group</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.delete_post"</span><span class="p">))</span> <span class="c1"># =&gt; False</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.change_post"</span><span class="p">))</span> <span class="c1"># =&gt; False</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.view_post"</span><span class="p">))</span> <span class="c1"># =&gt; True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.add_post"</span><span class="p">))</span> <span class="c1"># =&gt; True</span>
</code></pre></div>

<h2 id="enforcing-permissions">强制权限</h2>
<p>除了Django Admin之外，权限通常是在视图层执行的，因为用户是从请求对象获得的。</p>
<p>要在基于类的视图中实施权限，您可以使用来自<code>django.contrib.auth.mixins</code>的<a href="https://docs.djangoproject.com/en/4.0/topics/auth/default/#django.contrib.auth.mixins.PermissionRequiredMixin">permissionrequiredminix</a>，如下所示:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">PermissionRequiredMixin</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="k">class</span> <span class="nc">PostListView</span><span class="p">(</span><span class="n">PermissionRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="s2">"blog.view_post"</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"post.html"</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
</code></pre></div>

<p><code>permission_required</code>可以是单一权限，也可以是可重复的权限。如果使用iterable，用户必须拥有所有权限才能访问视图:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">PermissionRequiredMixin</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>

<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="k">class</span> <span class="nc">PostListView</span><span class="p">(</span><span class="n">PermissionRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"blog.view_post"</span><span class="p">,</span> <span class="s2">"blog.add_post"</span><span class="p">)</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"post.html"</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
</code></pre></div>

<p>对于基于函数的视图，使用<code>permission_required</code>装饰器:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">permission_required</span>

<span class="nd">@permission_required</span><span class="p">(</span><span class="s2">"blog.view_post"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">post_list_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">()</span>
</code></pre></div>

<p>您还可以在Django模板中检查权限。使用Django的auth context处理器，当你渲染你的模板时，一个<a href="https://docs.djangoproject.com/en/4.0/topics/auth/default/#permissions"> perms </a>变量是默认可用的。<code>perms</code>变量实际上包含了Django应用程序中的所有权限。</p>
<p>例如:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">perms</span><span class="o">.</span><span class="n">blog</span><span class="o">.</span><span class="n">view_post</span> <span class="o">%</span><span class="p">}</span>
  <span class="p">{</span><span class="c1"># Your content here #}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div>

<h2 id="model-level-permissions">模型级权限</h2>
<p>您还可以通过<a href="https://docs.djangoproject.com/en/4.0/ref/models/options/"> model Meta </a>选项向Django模型添加定制权限。</p>
<p>让我们给<code>Post</code>模型添加一个<code>is_published</code>标志:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">is_published</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<p>接下来，我们将设置一个名为<code>set_published_status</code>的自定义权限:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">is_published</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="s2">"set_published_status"</span><span class="p">,</span>
                <span class="s2">"Can set the status of the post to either publish or not"</span>
            <span class="p">)</span>
        <span class="p">]</span>
</code></pre></div>

<p>为了实施这个权限，我们可以在视图中使用Django提供的mixin，这给了我们显式检查用户是否拥有所需权限的灵活性。</p>
<p>下面是一个基于类的视图，它检查用户是否有权限设置帖子的发布状态:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">UserPassesTestMixin</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>

<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="k">class</span> <span class="nc">PostListView</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"post_details.html"</span>

    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">"blog.set_published_status"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">post_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'post_id'</span><span class="p">)</span>
        <span class="n">published_status</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'published_status'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">post_id</span><span class="p">:</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">is_published</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">published_status</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">)</span>
</code></pre></div>

<p>因此，使用<code>UserPassesTestMixin</code>，您需要覆盖该类的<code>test_func</code>方法并添加您自己的测试。请注意，该方法的返回值必须始终是布尔值。</p>
<h2 id="object-level-permissions">对象级权限</h2>
<p>如果您使用的是Django REST框架，它已经将<a href="https://www.django-rest-framework.org/api-guide/permissions/#object-level-permissions">对象级权限</a>内置到基本权限类中。<code>BasePermission</code>有<code>has_permission</code>，主要用于列表视图，还有<code>has_object_permission</code>，用于检查用户是否有权限访问单个模型实例。</p>
<blockquote>
<p>有关Django REST框架中权限的更多信息，请查看Django REST框架中的<a href="/blog/drf-permissions/">权限。</a></p>
</blockquote>
<p>如果您没有使用Django REST框架，要实现对象级权限，您可以使用第三方，比如:</p>

<blockquote>
<p>更多与权限相关的包，请查看<a href="https://djangopackages.org/grids/g/perms/"> Django包</a>。</p>
</blockquote>
<h2 id="conclusion">结论</h2>
<p>在本文中，您已经学习了如何向Django模型添加权限并检查权限。如果您有一定数量的用户类型，您可以将每个用户类型创建为一个组，并向该组授予必要的权限。然后，对于添加到系统和所需组中的每个用户，权限会自动授予每个用户。</p>
  </div>

  </div>    
</body>
</html>