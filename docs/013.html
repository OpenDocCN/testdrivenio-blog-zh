<html>
<head>
<title>Storing Django Static and Media Files on Amazon S3 </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在亚马逊S3上存储Django静态和媒体文件</h1>
<blockquote>原文：<a href="https://testdriven.io/blog/storing-django-static-and-media-files-on-amazon-s3/#0001-01-01">https://testdriven.io/blog/storing-django-static-and-media-files-on-amazon-s3/#0001-01-01</a></blockquote><div><div class="blog-content long-content" data-local-nav-source="">
    <p>亚马逊的<a href="https://aws.amazon.com/s3/">简单存储系统</a> (S3)提供了一种简单、经济的方式来存储静态文件。本教程展示了如何配置Django，通过一个亚马逊S3桶来加载和提供静态的和用户上传的媒体文件，公共的和私有的。</p>
<p><em>主要依赖关系</em>:</p>
<ol>
<li>django 4 . 1 . 5版</li>
<li>文档v20.10.22</li>
<li>python 3 . 11 . 1版</li>
</ol>
<blockquote>
<p>更喜欢使用数字海洋空间？查看在数字海洋空间上存储Django静态和媒体文件的<a href="/blog/django-digitalocean-spaces/">。</a></p>
</blockquote>



<h2 id="s3-bucket">S3水桶</h2>
<p>开始之前，你需要一个<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/sign-up-for-aws.html"> AWS </a>账户。如果你是AWS新手，亚马逊提供了一个带有5GB S3存储的<a href="https://aws.amazon.com/free/">免费层</a>。</p>
<p>要创建一个<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html"> S3存储桶</a>，导航到<a href="https://console.aws.amazon.com/s3"> S3页面</a>并点击“创建存储桶”:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_s3_1.png" loading="lazy" class="lazyload" alt="aws s3" src="../Images/9aad64c20435265d29b8e66904cef671.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_s3_1.png"/></p>
<p>给bucket起一个<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/BucketRestrictions.html">唯一的、符合DNS的名字</a>，并选择一个<a href="https://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region">地区</a>:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_s3_2.png" loading="lazy" class="lazyload" alt="aws s3" src="../Images/a4110cd0149264d5316f9ee9aa2f801c.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_s3_2.png"/></p>
<p>在“对象所有权”下，选择“启用ACL”。</p>
<p>关闭“阻止所有公共访问”:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_s3_5.png" loading="lazy" class="lazyload" alt="aws s3" src="../Images/3b842f2c7db64272ed248a377593dde4.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_s3_5.png"/></p>
<p>创建存储桶。现在，您应该可以在S3主页上看到您的存储桶了:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_s3_3.png" loading="lazy" class="lazyload" alt="aws s3" src="../Images/569a8faea60487375b160235261c89b9.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_s3_3.png"/></p>
<h2 id="iam-access">IAM访问</h2>
<p>尽管您可以使用AWS root用户，但出于安全考虑，最好创建一个IAM用户，该用户只能访问S3或特定的S3存储桶。此外，通过建立一个组，分配(和删除)对bucket的访问变得更加容易。因此，我们将首先建立一个具有有限<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html">权限</a>的组，然后创建一个用户并将该用户分配到该组。</p>
<h3 id="iam-group">IAM集团</h3>
<p>在<a href="https://console.aws.amazon.com/"> AWS控制台</a>中，导航至主<a href="https://console.aws.amazon.com/iamv2/home"> IAM页面</a>，点击侧边栏上的“用户组”。然后，单击“创建组”按钮。为该组提供一个名称，然后搜索并选择内置策略“AmazonS3FullAccess”:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_iam_1.png" loading="lazy" class="lazyload" alt="aws iam" src="../Images/7923d000bff5d7f0ca87049e638f73a0.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_iam_1.png"/></p>
<p>点击“创建群组”完成群组设置:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_iam_2.png" loading="lazy" class="lazyload" alt="aws iam" src="../Images/ef2b1f3cb6d63398d1dc12b054c1a5fb.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_iam_2.png"/></p>
<blockquote>
<p>如果您想对我们刚刚创建的特定存储桶进一步限制访问，请创建一个具有以下权限的新策略:</p>
<div class="codehilite"><pre><span/><span class="p">{</span>
    <span class="nt">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
    <span class="nt">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
            <span class="nt">"Action"</span><span class="p">:</span> <span class="s2">"s3:*"</span><span class="p">,</span>
            <span class="nt">"Resource"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"arn:aws:s3:::your-bucket-name"</span><span class="p">,</span>
                <span class="s2">"arn:aws:s3:::your-bucket-name/*"</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div><p>一定要用实际名称替换<code>your-bucket-name</code>。然后，从组中分离“AmazonS3FullAccess”策略，并附加新策略。</p></blockquote>

<h3 id="iam-user">IAM用户</h3>
<p>回到主<a href="https://console.aws.amazon.com/iamv2/home"> IAM页面</a>，点击“用户”，然后点击“添加用户”。定义用户名，然后单击“下一步”按钮。</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_iam_3.png" loading="lazy" class="lazyload" alt="aws iam" src="../Images/b3a02ce6542b3dceff0e0aca9f410875.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_iam_3.png"/></p>
<p>在“权限”步骤中，选择我们刚刚创建的组:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_iam_4.png" loading="lazy" class="lazyload" alt="aws iam" src="../Images/5e59296dfe2d13b199a7a7454a922dcc.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_iam_4.png"/></p>
<p>单击“创建用户”创建新用户。</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_iam_5.png" loading="lazy" class="lazyload" alt="aws iam" src="../Images/d8ba8cb3d49ccbf24d5f3700bacd0595.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_iam_5.png"/></p>
<p>现在，单击用户名查看用户详细信息。单击“安全凭证”选项卡，然后单击“创建访问密钥”。选择“本地代码”并单击下一步按钮。</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_iam_6.png" loading="lazy" class="lazyload" alt="aws iam" src="../Images/8d3d98d1bbcf39712231ec5039735f9a.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_iam_6.png"/></p>
<p>之后，点击“创建访问密钥”按钮并记下密钥。</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_iam_7.png" loading="lazy" class="lazyload" alt="aws iam" src="../Images/36f90a06b68d066d29497b6bc10aa80b.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_iam_7.png"/></p>
<h2 id="django-project">Django项目</h2>
<p>克隆下<a href="https://github.com/testdrivenio/django-docker-s3"> django-docker-s3 </a> repo，然后检查<a href="https://github.com/testdrivenio/django-docker-s3/tree/base">基地</a>分支:</p>
<div class="codehilite"><pre><span/><code>$ git clone https://github.com/testdrivenio/django-docker-s3 --branch base --single-branch
$ <span class="nb">cd</span> django-docker-s3
</code></pre></div>

<p>从项目根目录，创建映像并启动Docker容器:</p>
<div class="codehilite"><pre><span/><code>$ docker-compose up -d --build
</code></pre></div>

<p>构建完成后，收集静态文件:</p>
<div class="codehilite"><pre><span/><code>$ docker-compose <span class="nb">exec</span> web python manage.py collectstatic
</code></pre></div>

<p>然后，导航到<a href="http://localhost:1337"> http://localhost:1337 </a>:</p>
<p><img data-src="/static/images/blog/django/django-s3/app.png" loading="lazy" class="lazyload" alt="app" src="../Images/8ef57a100e74841e256663166746e85c.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/app.png"/></p>
<p>您应该能够上传一张图片，然后在<a href="http://localhost:1337/mediafiles/IMAGE_FILE_NAME">http://localhost:1337/media files/IMAGE _ FILE _ NAME</a>查看该图片。</p>
<blockquote>
<p>公共与私有的单选按钮不起作用。我们将在本教程的后面添加这个功能。暂时忽略它们。</p>
</blockquote>
<p>在继续之前，快速浏览一下项目结构:</p>
<div class="codehilite"><pre><span/><code>├── .gitignore
├── LICENSE
├── README.md
├── app
│   ├── Dockerfile
│   ├── hello_django
│   │   ├── __init__.py
│   │   ├── asgi.py
│   │   ├── settings.py
│   │   ├── urls.py
│   │   └── wsgi.py
│   ├── manage.py
│   ├── mediafiles
│   ├── requirements.txt
│   ├── static
│   │   └── bulma.min.css
│   ├── staticfiles
│   └── upload
│       ├── __init__.py
│       ├── admin.py
│       ├── apps.py
│       ├── migrations
│       │   └── __init__.py
│       ├── models.py
│       ├── templates
│       │   └── upload.html
│       ├── tests.py
│       └── views.py
├── docker-compose.yml
└── nginx
    ├── Dockerfile
    └── nginx.conf
</code></pre></div>

<blockquote>
<p>想学习如何构建这个项目吗？查看关于Django与Postgres、Gunicorn和Nginx的文章。</p>
</blockquote>
<h2 id="django-storages">Django仓库</h2>
<p>接下来，安装<a href="https://django-storages.readthedocs.io">django-stores</a>，使用S3作为主要的Django存储后端，以及<a href="https://boto3.readthedocs.io/"> boto3 </a>，与AWS API交互。</p>
<p>更新需求文件:</p>
<div class="codehilite"><pre><span/><code>boto3==1.26.59
Django==4.1.5
django-storages==1.13.2
gunicorn==20.1.0
</code></pre></div>

<p>将<code>storages</code>添加到<em>设置. py </em>中的<code>INSTALLED_APPS</code>中:</p>
<div class="codehilite"><pre><span/><code><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s1">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s1">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s1">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s1">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s1">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s1">'upload'</span><span class="p">,</span>
    <span class="s1">'storages'</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<p>更新图像并旋转新容器:</p>
<div class="codehilite"><pre><span/><code>$ docker-compose up -d --build
</code></pre></div>

<h2 id="static-files">静态文件</h2>
<p>接下来，我们需要更新对<em> settings.py </em>中静态文件的处理:</p>
<div class="codehilite"><pre><span/><code><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">'/staticfiles/'</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'staticfiles'</span><span class="p">)</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'static'</span><span class="p">),)</span>


<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">'/mediafiles/'</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'mediafiles'</span><span class="p">)</span>
</code></pre></div>

<p>用以下内容替换这些设置:</p>
<div class="codehilite"><pre><span/><code><span class="n">USE_S3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'USE_S3'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'TRUE'</span>

<span class="k">if</span> <span class="n">USE_S3</span><span class="p">:</span>
    <span class="c1"># aws settings</span>
    <span class="n">AWS_ACCESS_KEY_ID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_ACCESS_KEY_ID'</span><span class="p">)</span>
    <span class="n">AWS_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_SECRET_ACCESS_KEY'</span><span class="p">)</span>
    <span class="n">AWS_STORAGE_BUCKET_NAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_STORAGE_BUCKET_NAME'</span><span class="p">)</span>
    <span class="n">AWS_DEFAULT_ACL</span> <span class="o">=</span> <span class="s1">'public-read'</span>
    <span class="n">AWS_S3_CUSTOM_DOMAIN</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">AWS_STORAGE_BUCKET_NAME</span><span class="si">}</span><span class="s1">.s3.amazonaws.com'</span>
    <span class="n">AWS_S3_OBJECT_PARAMETERS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'CacheControl'</span><span class="p">:</span> <span class="s1">'max-age=86400'</span><span class="p">}</span>
    <span class="c1"># s3 static settings</span>
    <span class="n">AWS_LOCATION</span> <span class="o">=</span> <span class="s1">'static'</span>
    <span class="n">STATIC_URL</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'https://</span><span class="si">{</span><span class="n">AWS_S3_CUSTOM_DOMAIN</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">AWS_LOCATION</span><span class="si">}</span><span class="s1">/'</span>
    <span class="n">STATICFILES_STORAGE</span> <span class="o">=</span> <span class="s1">'storages.backends.s3boto3.S3Boto3Storage'</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">'/staticfiles/'</span>
    <span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'staticfiles'</span><span class="p">)</span>

<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'static'</span><span class="p">),)</span>

<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">'/mediafiles/'</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'mediafiles'</span><span class="p">)</span>
</code></pre></div>

<p>注意<code>USE_S3</code>和<code>STATICFILES_STORAGE</code>:</p>
<ol>
<li><code>USE_S3</code>环境变量用于打开(值为<code>TRUE</code>)和关闭(值为<code>FALSE</code>)S3存储。因此，您可以配置两个Docker合成文件:一个用于关闭S3的开发，另一个用于打开S3的生产。</li>
<li><code>STATICFILES_STORAGE</code> <a href="https://django-storages.readthedocs.io/en/latest/backends/amazon-S3.html?highlight=STATICFILES_STORAGE">设置</a>配置Django在运行<code>collectstatic</code>命令时自动将静态文件添加到S3桶中。</li>
</ol>
<blockquote>
<p>查看官方django-storages文档,了解关于上述设置和配置的更多信息。</p>
</blockquote>
<p>向<em> docker-compose.yml </em>文件中的<code>web</code>服务添加适当的环境变量:</p>
<div class="codehilite"><pre><span/><code><span class="nt">web</span><span class="p">:</span><span class="w"/>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./app</span><span class="w"/>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bash -c 'while !&lt;/dev/tcp/db/5432; do sleep 1; done; gunicorn hello_django.wsgi:application --bind 0.0.0.0:8000'</span><span class="w"/>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./app/:/usr/src/app/</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">static_volume:/usr/src/app/staticfiles</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">media_volume:/usr/src/app/mediafiles</span><span class="w"/>
<span class="w">  </span><span class="nt">expose</span><span class="p">:</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span><span class="w"/>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SECRET_KEY=please_change_me</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQL_ENGINE=django.db.backends.postgresql</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQL_DATABASE=postgres</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQL_USER=postgres</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQL_PASSWORD=postgres</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQL_HOST=db</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SQL_PORT=5432</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE=postgres</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">USE_S3=TRUE</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS_ACCESS_KEY_ID=UPDATE_ME</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS_SECRET_ACCESS_KEY=UPDATE_ME</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS_STORAGE_BUCKET_NAME=UPDATE_ME</span><span class="w"/>
<span class="w">  </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"/>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span><span class="w"/>
</code></pre></div>

<blockquote>
<p>不要忘记用您刚刚创建的用户密钥和<code>AWS_STORAGE_BUCKET_NAME</code>一起更新<code>AWS_ACCESS_KEY_ID</code>和<code>AWS_SECRET_ACCESS_KEY</code>。</p>
</blockquote>
<p>要测试、重新构建和运行容器:</p>
<div class="codehilite"><pre><span/><code>$ docker-compose down -v
$ docker-compose up -d --build
</code></pre></div>

<p>收集静态文件:</p>
<div class="codehilite"><pre><span/><code>$ docker-compose <span class="nb">exec</span> web python manage.py collectstatic
</code></pre></div>

<p>由于文件正在被上传到S3存储桶，所以这将花费比以前更长的时间。</p>
<p><a href="http://localhost:1337"> http://localhost:1337 </a>应该仍能正确渲染:</p>
<p><img data-src="/static/images/blog/django/django-s3/app.png" loading="lazy" class="lazyload" alt="app" src="../Images/8ef57a100e74841e256663166746e85c.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/app.png"/></p>
<p>查看页面源代码以确保CSS样式表是从S3存储桶中提取的:</p>
<p><img data-src="/static/images/blog/django/django-s3/app_2.png" loading="lazy" class="lazyload" alt="app" src="../Images/53a02af59f29c713fe98a9f75e35cd13.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/app_2.png"/></p>
<p>验证可以在AWS控制台上的S3存储桶的“static”子文件夹中看到静态文件:</p>
<p><img data-src="/static/images/blog/django/django-s3/aws_s3_4.png" loading="lazy" class="lazyload" alt="aws s3" src="../Images/bbd1c4e76efd60d54e7df5bac89377d7.png" data-original-src="https://testdriven.io/static/images/blog/django/django-s3/aws_s3_4.png"/></p>
<blockquote>
<p>媒体上传仍然会触及本地文件系统，因为我们只为静态文件配置了S3。我们将很快处理媒体上传。</p>
</blockquote>
<p>最后，将<code>USE_S3</code>的值更新为<code>FALSE</code>并重新构建映像，以确保Django使用本地文件系统来存储静态文件。完成后，将<code>USE_S3</code>变回<code>TRUE</code>。</p>

<p>为了防止用户覆盖现有的静态文件，媒体文件上传应该放在桶中不同的子文件夹中。我们将通过为每种类型的存储创建自定义存储类来解决这个问题。</p>
<p>将名为<em> storage_backends.py </em>的新文件添加到“app/hello_django”文件夹中:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">storages.backends.s3boto3</span> <span class="kn">import</span> <span class="n">S3Boto3Storage</span>


<span class="k">class</span> <span class="nc">StaticStorage</span><span class="p">(</span><span class="n">S3Boto3Storage</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="s1">'static'</span>
    <span class="n">default_acl</span> <span class="o">=</span> <span class="s1">'public-read'</span>


<span class="k">class</span> <span class="nc">PublicMediaStorage</span><span class="p">(</span><span class="n">S3Boto3Storage</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="s1">'media'</span>
    <span class="n">default_acl</span> <span class="o">=</span> <span class="s1">'public-read'</span>
    <span class="n">file_overwrite</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

<p>对<em> settings.py </em>进行以下更改:</p>
<div class="codehilite"><pre><span/><code><span class="n">USE_S3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'USE_S3'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'TRUE'</span>

<span class="k">if</span> <span class="n">USE_S3</span><span class="p">:</span>
    <span class="c1"># aws settings</span>
    <span class="n">AWS_ACCESS_KEY_ID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_ACCESS_KEY_ID'</span><span class="p">)</span>
    <span class="n">AWS_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_SECRET_ACCESS_KEY'</span><span class="p">)</span>
    <span class="n">AWS_STORAGE_BUCKET_NAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_STORAGE_BUCKET_NAME'</span><span class="p">)</span>
    <span class="n">AWS_DEFAULT_ACL</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">AWS_S3_CUSTOM_DOMAIN</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">AWS_STORAGE_BUCKET_NAME</span><span class="si">}</span><span class="s1">.s3.amazonaws.com'</span>
    <span class="n">AWS_S3_OBJECT_PARAMETERS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'CacheControl'</span><span class="p">:</span> <span class="s1">'max-age=86400'</span><span class="p">}</span>
    <span class="c1"># s3 static settings</span>
    <span class="n">STATIC_LOCATION</span> <span class="o">=</span> <span class="s1">'static'</span>
    <span class="n">STATIC_URL</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'https://</span><span class="si">{</span><span class="n">AWS_S3_CUSTOM_DOMAIN</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">STATIC_LOCATION</span><span class="si">}</span><span class="s1">/'</span>
    <span class="n">STATICFILES_STORAGE</span> <span class="o">=</span> <span class="s1">'hello_django.storage_backends.StaticStorage'</span>
    <span class="c1"># s3 public media settings</span>
    <span class="n">PUBLIC_MEDIA_LOCATION</span> <span class="o">=</span> <span class="s1">'media'</span>
    <span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'https://</span><span class="si">{</span><span class="n">AWS_S3_CUSTOM_DOMAIN</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">PUBLIC_MEDIA_LOCATION</span><span class="si">}</span><span class="s1">/'</span>
    <span class="n">DEFAULT_FILE_STORAGE</span> <span class="o">=</span> <span class="s1">'hello_django.storage_backends.PublicMediaStorage'</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">'/staticfiles/'</span>
    <span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'staticfiles'</span><span class="p">)</span>
    <span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">'/mediafiles/'</span>
    <span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'mediafiles'</span><span class="p">)</span>

<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'static'</span><span class="p">),)</span>
</code></pre></div>

<p>随着<code>DEFAULT_FILE_STORAGE</code> <a href="https://django-storages.readthedocs.io/en/latest/backends/amazon-S3.html?highlight=DEFAULT_FILE_STORAGE">设置</a>现在被设置，所有的<a href="https://docs.djangoproject.com/en/4.1/ref/models/fields/#filefield">文件域</a>将它们的内容上传到S3桶。继续之前，请检查其余设置。</p>
<p>接下来，让我们对<code>upload</code>应用程序做一些修改。</p>
<p><em> app/upload/models.py </em>:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Upload</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">uploaded_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">()</span>
</code></pre></div>

<p><em> app/upload/views.py </em>:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core.files.storage</span> <span class="kn">import</span> <span class="n">FileSystemStorage</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Upload</span>


<span class="k">def</span> <span class="nf">image_upload</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">:</span>
        <span class="n">image_file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">'image_file'</span><span class="p">]</span>
        <span class="n">image_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">'image_type'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_S3</span><span class="p">:</span>
            <span class="n">upload</span> <span class="o">=</span> <span class="n">Upload</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">image_file</span><span class="p">)</span>
            <span class="n">upload</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">image_url</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">FileSystemStorage</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">image_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)</span>
            <span class="n">image_url</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'upload.html'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'image_url'</span><span class="p">:</span> <span class="n">image_url</span>
        <span class="p">})</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'upload.html'</span><span class="p">)</span>
</code></pre></div>

<p>创建新的迁移文件，然后构建新的映像:</p>
<div class="codehilite"><pre><span/><code>$ docker-compose <span class="nb">exec</span> web python manage.py makemigrations
$ docker-compose down -v
$ docker-compose up -d --build
$ docker-compose <span class="nb">exec</span> web python manage.py migrate
</code></pre></div>

<p>测试一下！在<a href="http://localhost:1337"> http://localhost:1337 </a>上传一张图片。图像应该上传到S3(媒体子文件夹)和<code>image_url</code>应该包括S3的网址:</p>
<p><img data-src="/static/images/gifs/blog/django-s3/public-media.gif" loading="lazy" class="lazyload" alt="app demo" src="../Images/99df160d00438d8d5d22665612f3a827.png" data-original-src="https://testdriven.io/static/images/gifs/blog/django-s3/public-media.gif"/></p>

<p>向<em> storage_backends.py </em>添加一个新类:</p>
<div class="codehilite"><pre><span/><code><span class="k">class</span> <span class="nc">PrivateMediaStorage</span><span class="p">(</span><span class="n">S3Boto3Storage</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="s1">'private'</span>
    <span class="n">default_acl</span> <span class="o">=</span> <span class="s1">'private'</span>
    <span class="n">file_overwrite</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">custom_domain</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

<p>添加适当的设置:</p>
<div class="codehilite"><pre><span/><code><span class="n">USE_S3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'USE_S3'</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'TRUE'</span>

<span class="k">if</span> <span class="n">USE_S3</span><span class="p">:</span>
    <span class="c1"># aws settings</span>
    <span class="n">AWS_ACCESS_KEY_ID</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_ACCESS_KEY_ID'</span><span class="p">)</span>
    <span class="n">AWS_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_SECRET_ACCESS_KEY'</span><span class="p">)</span>
    <span class="n">AWS_STORAGE_BUCKET_NAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">'AWS_STORAGE_BUCKET_NAME'</span><span class="p">)</span>
    <span class="n">AWS_DEFAULT_ACL</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">AWS_S3_CUSTOM_DOMAIN</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">AWS_STORAGE_BUCKET_NAME</span><span class="si">}</span><span class="s1">.s3.amazonaws.com'</span>
    <span class="n">AWS_S3_OBJECT_PARAMETERS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'CacheControl'</span><span class="p">:</span> <span class="s1">'max-age=86400'</span><span class="p">}</span>
    <span class="c1"># s3 static settings</span>
    <span class="n">STATIC_LOCATION</span> <span class="o">=</span> <span class="s1">'static'</span>
    <span class="n">STATIC_URL</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'https://</span><span class="si">{</span><span class="n">AWS_S3_CUSTOM_DOMAIN</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">STATIC_LOCATION</span><span class="si">}</span><span class="s1">/'</span>
    <span class="n">STATICFILES_STORAGE</span> <span class="o">=</span> <span class="s1">'hello_django.storage_backends.StaticStorage'</span>
    <span class="c1"># s3 public media settings</span>
    <span class="n">PUBLIC_MEDIA_LOCATION</span> <span class="o">=</span> <span class="s1">'media'</span>
    <span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'https://</span><span class="si">{</span><span class="n">AWS_S3_CUSTOM_DOMAIN</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">PUBLIC_MEDIA_LOCATION</span><span class="si">}</span><span class="s1">/'</span>
    <span class="n">DEFAULT_FILE_STORAGE</span> <span class="o">=</span> <span class="s1">'hello_django.storage_backends.PublicMediaStorage'</span>
    <span class="c1"># s3 private media settings</span>
    <span class="n">PRIVATE_MEDIA_LOCATION</span> <span class="o">=</span> <span class="s1">'private'</span>
    <span class="n">PRIVATE_FILE_STORAGE</span> <span class="o">=</span> <span class="s1">'hello_django.storage_backends.PrivateMediaStorage'</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">'/staticfiles/'</span>
    <span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'staticfiles'</span><span class="p">)</span>
    <span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">'/mediafiles/'</span>
    <span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'mediafiles'</span><span class="p">)</span>

<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'static'</span><span class="p">),)</span>
</code></pre></div>

<p>在<em> app/upload/models.py </em>中创建新模型:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">hello_django.storage_backends</span> <span class="kn">import</span> <span class="n">PublicMediaStorage</span><span class="p">,</span> <span class="n">PrivateMediaStorage</span>


<span class="k">class</span> <span class="nc">Upload</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">uploaded_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">PublicMediaStorage</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">UploadPrivate</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">uploaded_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">PrivateMediaStorage</span><span class="p">())</span>
</code></pre></div>

<p>然后，更新视图:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.core.files.storage</span> <span class="kn">import</span> <span class="n">FileSystemStorage</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Upload</span><span class="p">,</span> <span class="n">UploadPrivate</span>


<span class="k">def</span> <span class="nf">image_upload</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">:</span>
        <span class="n">image_file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">'image_file'</span><span class="p">]</span>
        <span class="n">image_type</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">'image_type'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_S3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">'private'</span><span class="p">:</span>
                <span class="n">upload</span> <span class="o">=</span> <span class="n">UploadPrivate</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">image_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">upload</span> <span class="o">=</span> <span class="n">Upload</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">image_file</span><span class="p">)</span>
            <span class="n">upload</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">image_url</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">FileSystemStorage</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">image_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">image_file</span><span class="p">)</span>
            <span class="n">image_url</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'upload.html'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">'image_url'</span><span class="p">:</span> <span class="n">image_url</span>
        <span class="p">})</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'upload.html'</span><span class="p">)</span>
</code></pre></div>

<p>同样，创建迁移文件，重新构建映像，并启动新容器:</p>
<div class="codehilite"><pre><span/><code>$ docker-compose <span class="nb">exec</span> web python manage.py makemigrations
$ docker-compose down -v
$ docker-compose up -d --build
$ docker-compose <span class="nb">exec</span> web python manage.py migrate
</code></pre></div>

<p>为了测试，在<a href="http://localhost:1337"> http://localhost:1337 </a>上传一个私有镜像。像公共图像一样，图像应该上传到S3(到私有子文件夹)，并且<code>image_url</code>应该包括S3 URL以及以下查询字符串参数:</p>
<ol>
<li>AWSAccessKeyId</li>
<li>签名</li>
<li>期满</li>
</ol>
<p>本质上，我们创建了一个临时的、已签名的URL，用户可以在特定的时间段内访问它。没有参数，您将无法直接访问它。</p>
<p><img data-src="/static/images/gifs/blog/django-s3/private-media.gif" loading="lazy" class="lazyload" alt="app demo" src="../Images/23b175be64c55ec4c74340b3c1a072fe.png" data-original-src="https://testdriven.io/static/images/gifs/blog/django-s3/private-media.gif"/></p>
<h2 id="conclusion">结论</h2>
<p>本教程向您展示了如何在Amazon S3上创建一个bucket，配置一个IAM用户和组，并设置Django来上传和服务静态文件和来自S3的媒体上传。</p>
<p>通过使用S3，您可以:</p>
<ol>
<li>增加静态文件和媒体文件的可用空间</li>
<li>减轻您自己的服务器的压力，因为它不再需要提供文件</li>
<li>可以限制对特定文件的访问</li>
<li>可以利用<a href="https://aws.amazon.com/cloudfront/"> CloudFront </a> CDN</li>
</ol>
<p>如果我们遗漏了什么，或者您有任何其他提示和技巧，请告诉我们。你可以在<a href="https://github.com/testdrivenio/django-docker-s3"> django-docker-s3 </a> repo中找到最终代码。</p>
  </div>

  </div>    
</body>
</html>