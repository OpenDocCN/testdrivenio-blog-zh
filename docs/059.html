<html>
<head>
<title>Rapid Prototyping with Django, htmx, and Tailwind CSS </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Django、htmx和Tailwind CSS进行快速原型制作</h1>
<blockquote>原文：<a href="https://testdriven.io/blog/django-htmx-tailwind/#0001-01-01">https://testdriven.io/blog/django-htmx-tailwind/#0001-01-01</a></blockquote><div><div class="blog-content long-content" data-local-nav-source="">
    <p>在本教程中，你将学习如何用<a href="https://htmx.org/"> htmx </a>和<a href="https://tailwindcss.com/"> Tailwind CSS </a>设置Django。htmx和Tailwind的目标都是简化现代web开发，这样您就可以设计和实现交互性，而不会离开HTML的舒适和方便。我们还将看看如何使用<a href="https://django-compressor.readthedocs.io/en/stable/"> Django Compressor </a>来捆绑和缩小Django应用程序中的静态资产。</p>



<h2 id="htmx">htmx</h2>
<p>htmx 是一个库，它允许你直接从HTML访问现代浏览器特性，如AJAX、CSS转换、WebSockets和服务器发送的事件，而不是使用JavaScript。它允许您直接在标记中快速构建用户界面。</p>
<p>htmx扩展了浏览器已经内置的几个特性，比如发出HTTP请求和响应事件。例如，您可以使用HTML属性在任何HTML元素上发送GET、POST、PUT、PATCH或DELETE请求，而不仅仅是通过<code>a</code>和<code>form</code>元素发出GET和POST请求:</p>
<div class="codehilite"><pre><span/><code><span class="p">&lt;</span><span class="nt">button</span> <span class="na">hx-delete</span><span class="o">=</span><span class="s">"/user/1"</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</code></pre></div>

<p>您还可以更新页面的某些部分来创建单页应用程序(SPA):</p>
<p class="codepen" data-height="300" data-theme-id="0" data-default-tab="html,result" data-user="mjhea0" data-slug-hash="RwoJYyx" data-pen-title="RwoJYyx"><span>见<a href="https://codepen.io"> CodePen </a>上Michael Herman ( <a href="https://codepen.io/mjhea0"> @mjhea0 </a>)的笔<a href="https://codepen.io/mjhea0/pen/RwoJYyx"> RwoJYyx </a>。</span></p>


<p/>

<p><a href="https://codepen.io/mjhea0/pen/RwoJYyx"> CodePen链接</a></p>
<p>在浏览器的开发工具中打开网络标签。当点击按钮时，一个XHR请求被发送到<code>https://v2.jokeapi.dev/joke/Any?format=txt&amp;safe-mode</code>端点。然后，响应被附加到具有输出的<code>id</code>的<code>p</code>元素。</p>
<blockquote>
<p>如需更多示例，请查看官方htmx文档中的<a href="https://htmx.org/examples/"> UI示例</a>页面。</p>
</blockquote>
<h3 id="pros-and-cons">利弊</h3>
<p><strong>优点</strong>:</p>
<ol>
<li><em>开发者生产力</em>:你可以不用接触JavaScript就能构建现代化的用户界面。关于这方面的更多信息，请查看<a href="https://htmx.org/essays/spa-alternative/">的一个水疗选择</a>。</li>
<li><em>组合拳</em>:库本身很小(~10k min.gz'd)，无依赖性，<a href="https://htmx.org/extensions/">可扩展</a>。</li>
</ol>
<p><strong>缺点</strong>:</p>
<ol>
<li><em>库成熟度</em>:由于库相当新，文档和示例实现很少。</li>
<li><em>传输数据的大小</em>:通常，SPA框架(如React和Vue)通过在客户机和服务器之间以JSON格式来回传递数据来工作。然后，接收到的数据由客户端呈现。另一方面，htmx从服务器接收呈现的HTML，并用响应替换目标元素。呈现格式的HTML通常比JSON响应更大。</li>
</ol>
<h2 id="tailwind-css">顺风CSS</h2>
<p><a href="https://tailwindcss.com/"> Tailwind CSS </a>是一个“实用优先”的CSS框架。它不提供预先构建的组件(像<a href="https://getbootstrap.com/"> Bootstrap </a>和<a href="https://bulma.io/">布尔玛</a>这样的框架专门提供这些组件)，而是以实用程序类的形式提供构建模块，使人们能够快速、轻松地创建布局和设计。</p>
<p>例如，以下面的HTML和CSS为例:</p>
<div class="codehilite"><pre><span/><code><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"/>
<span class="p">.</span><span class="nc">hello</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span><span class="w"/>
<span class="w">  </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span><span class="w"/>
<span class="w">  </span><span class="k">background</span><span class="p">:</span><span class="w"> </span><span class="kc">gray</span><span class="p">;</span><span class="w"/>
<span class="w">  </span><span class="k">border-width</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="p">;</span><span class="w"/>
<span class="w">  </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="kt">px</span><span class="p">;</span><span class="w"/>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span><span class="w"/>
<span class="p">}</span><span class="w"/>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"hello"</span><span class="p">&gt;</span>Hello World<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<p>这可以通过顺风实现，如下所示:</p>
<div class="codehilite"><pre><span/><code><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"h-1 w-2 bg-gray-600 border rounded-sm p-1"</span><span class="p">&gt;</span>Hello World<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>

<p>查看<a href="https://tailwind-converter.netlify.app/"> CSS顺风转换器</a>将原始CSS转换为顺风中的等效实用程序类。比较结果。</p>
<h3 id="pros-and-cons_1">利弊</h3>
<p><strong>优点</strong>:</p>
<ol>
<li><em>高度可定制</em>:虽然Tailwind自带预建类，但是可以使用<em> tailwind.config.js </em>文件覆盖它们。</li>
<li><em>优化</em>:你可以<a href="https://tailwindcss.com/docs/content-configuration">配置</a> Tailwind，通过只加载实际使用的类来优化CSS输出。</li>
<li><em>黑暗模式</em>:轻松实现<a href="https://tailwindcss.com/docs/dark-mode">黑暗模式</a>——比如<code>&lt;div class="bg-white dark:bg-black"&gt;</code>。</li>
</ol>
<p><strong>缺点</strong>:</p>
<ol>
<li><em>组件</em> : Tailwind不提供任何官方预置的组件，比如按钮、卡片、导航条等等。组件必须从头开始创建。有一些社区驱动的组件资源，例如<a href="https://tailwindcomponents.com/">顺风CSS组件</a>和<a href="https://www.tailwindtoolbox.com/">顺风工具箱</a>。还有一个强大的组件库，尽管是付费的，由Tailwind的开发者开发，名为<a href="https://tailwindui.com/"> Tailwind UI </a>。</li>
<li>CSS是内联的:它将内容和设计结合在一起，增加了页面的大小，使HTML变得混乱。</li>
</ol>
<h2 id="django-compressor">Django压缩机</h2>
<p>Django Compressor是一个扩展，用于管理(压缩/缓存)Django应用程序中的静态资产。通过它，您可以为以下各项创建简单的资产管道:</p>
<ol>
<li>将<a href="https://sass-lang.com/"> Sass </a>和<a href="http://lesscss.org/"> LESS </a>编译成CSS样式表</li>
<li>将多个CSS和JavaScript文件合并并缩小为单个文件</li>
<li>创建在模板中使用的资产包</li>
</ol>
<p>至此，让我们来看看如何在Django中使用上述工具！</p>
<h2 id="project-setup">项目设置</h2>
<p>首先，为我们的项目创建一个新文件夹，创建并激活一个新的虚拟环境，并安装Django和Django Compressor:</p>
<div class="codehilite"><pre><span/><code>$ mkdir django-htmx-tailwind <span class="o">&amp;&amp;</span> <span class="nb">cd</span> django-htmx-tailwind
$ python3.10 -m venv venv
$ <span class="nb">source</span> venv/bin/activate
<span class="o">(</span>venv<span class="o">)</span>$

<span class="o">(</span>venv<span class="o">)</span>$ pip install <span class="nv">Django</span><span class="o">==</span><span class="m">4</span>.0.3 django-compressor<span class="o">==</span><span class="m">3</span>.1
</code></pre></div>

<p>接下来，让我们安装<a href="https://github.com/timonweb/pytailwindcss"> pytailwindcss </a>并下载它的二进制文件:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>venv<span class="o">)</span>$ pip install <span class="nv">pytailwindcss</span><span class="o">==</span><span class="m">0</span>.1.4
<span class="o">(</span>venv<span class="o">)</span>$ tailwindcss
</code></pre></div>

<p>创建一个新的Django项目和一个<code>todos</code>应用:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>venv<span class="o">)</span>$ django-admin startproject config .
<span class="o">(</span>venv<span class="o">)</span>$ python manage.py startapp todos
</code></pre></div>

<p>将应用添加到<em> config/settings.py </em>中的<code>INSTALLED_APPS</code>列表:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># config/settings.py</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s1">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s1">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s1">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s1">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s1">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s1">'todos'</span><span class="p">,</span>  <span class="c1"># new</span>
    <span class="s1">'compressor'</span><span class="p">,</span>  <span class="c1"># new</span>
<span class="p">]</span>
</code></pre></div>

<p>在项目的根目录下创建一个“模板”文件夹。然后，像这样更新<code>TEMPLATES</code>设置:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># config/settings.py</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="o">...</span>
        <span class="s1">'DIRS'</span><span class="p">:</span> <span class="p">[</span><span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'templates'</span><span class="p">],</span> <span class="c1"># new</span>
        <span class="o">...</span>
    <span class="p">},</span>
<span class="p">]</span>
</code></pre></div>

<p>让我们为<code>compressor</code>向<em> config/settings.py </em>添加一些配置:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># config/settings.py</span>

<span class="n">COMPRESS_ROOT</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'static'</span>

<span class="n">COMPRESS_ENABLED</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">STATICFILES_FINDERS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'compressor.finders.CompressorFinder'</span><span class="p">,)</span>
</code></pre></div>

<p>注意事项:</p>
<ol>
<li><a href="https://django-compressor.readthedocs.io/en/stable/settings.html#django.conf.settings.COMPRESS_ROOT"> COMPRESS_ROOT </a>定义要压缩的文件的读取和写入的绝对位置。</li>
<li><a href="https://django-compressor.readthedocs.io/en/stable/settings.html#django.conf.settings.COMPRESS_ENABLED"> COMPRESS_ENABLED </a>判断压缩是否会发生的布尔值。默认为<code>DEBUG</code>的相反值。</li>
<li>安装<code>django.contrib.staticfiles</code>时，必须包含Django Compressor的文件查找器。</li>
</ol>
<p>初始化项目中的顺风CSS:</p>


<p>该命令在项目的根目录下创建了一个<em> tailwind.config.js </em>文件。所有与顺风相关的定制都放在这个文件中。</p>
<p>更新<em> tailwind.config.js </em>这样:</p>
<div class="codehilite"><pre><span/><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"/>
<span class="w">    </span><span class="s1">'./templates/**/*.html'</span><span class="p">,</span><span class="w"/>
<span class="w">  </span><span class="p">],</span><span class="w"/>
<span class="w">  </span><span class="nx">theme</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="nx">extend</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w"/>
<span class="w">  </span><span class="p">},</span><span class="w"/>
<span class="w">  </span><span class="nx">plugins</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span><span class="w"/>
<span class="p">}</span><span class="w"/>
</code></pre></div>

<p>记下<a href="https://tailwindcss.com/docs/content-configuration">部分的内容</a>。在这里，您可以配置项目HTML模板的路径。顺风CSS将扫描你的模板，搜索顺风类名。生成的输出CSS文件将只包含模板文件中相关类名的CSS。这有助于保持生成的CSS文件较小，因为它们将只包含实际使用的样式。</p>
<p>接下来，在项目根目录中，创建以下文件和文件夹:</p>
<div class="codehilite"><pre><span/><code>static
└── src
    └── main.css
</code></pre></div>

<p>然后，将以下内容添加到<em> static/src/main.css </em>中:</p>
<div class="codehilite"><pre><span/><code><span class="c">/* static/src/main.css */</span><span class="w"/>

<span class="p">@</span><span class="k">tailwind</span><span class="w"> </span><span class="nt">base</span><span class="p">;</span><span class="w"/>
<span class="p">@</span><span class="k">tailwind</span><span class="w"> </span><span class="nt">components</span><span class="p">;</span><span class="w"/>
<span class="p">@</span><span class="k">tailwind</span><span class="w"> </span><span class="nt">utilities</span><span class="p">;</span><span class="w"/>
</code></pre></div>

<p>这里，我们定义了来自Tailwind CSS的所有<code>base</code>、<code>components</code>和<code>utilities</code>类。</p>
<p>就是这样。你现在有姜戈压缩机和顺风连线。接下来，我们将看看如何提供一个<em>index.html</em>文件来看看CSS的作用。</p>
<h2 id="simple-example">简单的例子</h2>
<p>像这样更新<em> todos/views.py </em>文件:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># todos/views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'index.html'</span><span class="p">)</span>
</code></pre></div>

<p>将视图添加到<em> todos/urls.py </em>:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># todos/urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">index</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'index'</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div>

<p>然后，将<code>todos.urls</code>添加到<em> config/urls.py </em>:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># config/urls.py</span>

<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'todos.urls'</span><span class="p">)),</span> <span class="c1"># new</span>
<span class="p">]</span>
</code></pre></div>

<p>向“模板”添加一个<em> _base.html </em>文件:</p>
<div class="codehilite"><pre><span/><code><span class="cm">&lt;!-- templates/_base.html --&gt;</span>

{% load compress %}
{% load static %}

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content</span><span class="o">=</span><span class="s">"IE=edge"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django + HTMX + Tailwind CSS<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    {% compress css %}
      <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% static 'src/output.css' %}"</span><span class="p">&gt;</span>
    {% endcompress %}

  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span> <span class="na">class</span><span class="o">=</span><span class="s">"bg-blue-100"</span><span class="p">&gt;</span>
    {% block content %}
    {% endblock content %}
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>注意事项:</p>
<ol>
<li><code>{% load compress %}</code>导入与Django Compressor配合使用所需的所有标签。</li>
<li><code>{% load static %}</code>将静态文件载入模板。</li>
<li><code>{% compress css %}</code>对<em>静态/src/main.css </em>文件应用适当的过滤器。</li>
</ol>
<p>此外，我们通过<code>&lt;body class="bg-blue-100"&gt;</code>给HTML主体添加了一些颜色。<code>bg-blue-100</code>用于将<a href="https://tailwindcss.com/docs/background-color">背景颜色</a>改为浅蓝色。</p>
<p>添加一个<em>index.html</em>文件:</p>
<div class="codehilite"><pre><span/><code><span class="cm">&lt;!-- templates/index.html --&gt;</span>

{% extends "_base.html" %}

{% block content %}
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello World<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{% endblock content %}
</code></pre></div>

<p>现在，在项目的根目录下运行以下命令，扫描模板中的类并生成一个CSS文件:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>venv<span class="o">)</span>$ tailwindcss -i ./static/src/main.css -o ./static/src/output.css --minify
</code></pre></div>

<p>应用迁移并运行开发服务器:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>venv<span class="o">)</span>$ python manage.py migrate
<span class="o">(</span>venv<span class="o">)</span>$ python manage.py runserver
</code></pre></div>

<p>在浏览器中导航到<a href="http://localhost:8000"> http://localhost:8000 </a>以查看结果。还要注意“static/CACHE/css”文件夹中生成的文件。</p>
<p>在配置了Tailwind之后，让我们将htmx添加到组合中，并构建一个在您键入时显示结果的live search。</p>
<h2 id="live-search-example">实时搜索示例</h2>
<p>与其从CDN中获取htmx库，不如下载它并使用Django Compressor进行捆绑。</p>
<p>从<a href="https://unpkg.com/htmx.org@1.7.0/dist/htmx.js">https://unpkg.com/<span class="__cf_email__" data-cfemail="d2baa6bfaafcbda0b592e3fce5fce2">【邮件保护】</span> /dist/htmx.js </a>下载库，保存到<em> static/src/htmx.js </em>。</p>
<p>为了让我们有一些数据可以处理，将<a href="https://github.com/testdrivenio/django-htmx-tailwind/blob/master/todos/todo.py">https://github . com/testdrivenio/django-htmx-tailwind/blob/master/todos/todo . py</a>保存到一个名为<em> todos/todo.py </em>的新文件中。</p>
<p>现在，将实现搜索功能的视图添加到<em> todos/views.py </em>:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># todos/views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.http</span> <span class="kn">import</span> <span class="n">require_http_methods</span>  <span class="c1"># new</span>

<span class="kn">from</span> <span class="nn">.todo</span> <span class="kn">import</span> <span class="n">todos</span>  <span class="c1"># new</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'index.html'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'todos'</span><span class="p">:</span> <span class="p">[]})</span> <span class="c1"># modified</span>


<span class="c1"># new</span>
<span class="nd">@require_http_methods</span><span class="p">([</span><span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">res_todos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">'search'</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'todo.html'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'todos'</span><span class="p">:</span> <span class="p">[]})</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">todos</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]:</span>
            <span class="n">res_todos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'todo.html'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'todos'</span><span class="p">:</span> <span class="n">res_todos</span><span class="p">})</span>
</code></pre></div>

<p>我们添加了一个新的视图<code>search</code>，它搜索todos并呈现带有所有结果的<em>todo.html</em>模板。</p>
<p>将新创建的视图添加到<em> todos/urls.py </em>:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># todos/urls.py</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.views</span> <span class="kn">import</span> <span class="n">index</span><span class="p">,</span> <span class="n">search</span>  <span class="c1"># modified</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'index'</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'search/'</span><span class="p">,</span> <span class="n">search</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'search'</span><span class="p">),</span>  <span class="c1"># new</span>
<span class="p">]</span>
</code></pre></div>

<p>接下来，将新资产添加到<em> _base.html </em>文件中:</p>
<div class="codehilite"><pre><span/><code><span class="cm">&lt;!-- templates/base.html --&gt;</span>

{% load compress %}
{% load static %}

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content</span><span class="o">=</span><span class="s">"IE=edge"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="na">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Django + HTMX + Tailwind CSS<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    {% compress css %}
      <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% static 'src/output.css' %}"</span><span class="p">&gt;</span>
    {% endcompress %}

  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span> <span class="na">class</span><span class="o">=</span><span class="s">"bg-blue-100"</span><span class="p">&gt;</span>
    {% block content %}
    {% endblock content %}

    <span class="cm">&lt;!-- new --&gt;</span>
    {% compress js %}
      <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">"{% static 'src/htmx.js' %}"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    {% endcompress %}

    <span class="cm">&lt;!-- new --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="w"/>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'htmx:configRequest'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'X-CSRFToken'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'{{ csrf_token }}'</span><span class="p">;</span><span class="w"/>
<span class="w">      </span><span class="p">})</span><span class="w"/>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>我们使用<code>{% compress js %}</code>标签加载了htmx库。<code>js</code>标签，默认为<a href="https://django-compressor.readthedocs.io/en/stable/settings.html?#django.conf.settings.COMPRESS_FILTERS"/>，应用<code>JSMinFilter</code>(反过来，应用<a href="https://pypi.org/project/rjsmin/"> rjsmin </a>)。因此，这将缩小<em> static/src/htmx.js </em>并从“static/CACHE”文件夹中提供它。</p>
<p>我们还添加了以下脚本:</p>
<div class="codehilite"><pre><span/><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'htmx:configRequest'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">  </span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'X-CSRFToken'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'{{ csrf_token }}'</span><span class="p">;</span><span class="w"/>
<span class="p">})</span><span class="w"/>
</code></pre></div>

<p>该事件侦听器将CSRF令牌添加到请求标头中。</p>
<p>接下来，让我们添加基于每个待办事项标题的搜索功能。</p>
<p>更新<em>index.html</em>文件是这样的:</p>
<div class="codehilite"><pre><span/><code><span class="cm">&lt;!-- templates/index.html --&gt;</span>

{% extends "_base.html" %}

{% block content %}
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"w-small w-2/3 mx-auto py-10 text-gray-600"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span>
      <span class="na">type</span><span class="o">=</span><span class="s">"text"</span>
      <span class="na">name</span><span class="o">=</span><span class="s">"search"</span>
      <span class="na">hx-post</span><span class="o">=</span><span class="s">"/search/"</span>
      <span class="na">hx-trigger</span><span class="o">=</span><span class="s">"keyup changed delay:250ms"</span>
      <span class="na">hx-indicator</span><span class="o">=</span><span class="s">".htmx-indicator"</span>
      <span class="na">hx-target</span><span class="o">=</span><span class="s">"#todo-results"</span>
      <span class="na">placeholder</span><span class="o">=</span><span class="s">"Search"</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"bg-white h-10 px-5 pr-10 rounded-full text-2xl focus:outline-none"</span>
    <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"htmx-indicator"</span><span class="p">&gt;</span>Searching...<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">"border-collapse w-small w-2/3 mx-auto"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">"p-3 font-bold uppercase bg-gray-200 text-gray-600 border border-gray-300 hidden lg:table-cell"</span><span class="p">&gt;</span>#<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">"p-3 font-bold uppercase bg-gray-200 text-gray-600 border border-gray-300 hidden lg:table-cell"</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">"p-3 font-bold uppercase bg-gray-200 text-gray-600 border border-gray-300 hidden lg:table-cell"</span><span class="p">&gt;</span>Completed<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">id</span><span class="o">=</span><span class="s">"todo-results"</span><span class="p">&gt;</span>
      {% include "todo.html" %}
    <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
{% endblock content %}
</code></pre></div>

<p>让我们花点时间来看看从htmx定义的属性:</p>
<div class="codehilite"><pre><span/><code><span class="p">&lt;</span><span class="nt">input</span>
  <span class="na">type</span><span class="o">=</span><span class="s">"text"</span>
  <span class="na">name</span><span class="o">=</span><span class="s">"search"</span>
  <span class="na">hx-post</span><span class="o">=</span><span class="s">"/search/"</span>
  <span class="na">hx-trigger</span><span class="o">=</span><span class="s">"keyup changed delay:250ms"</span>
  <span class="na">hx-indicator</span><span class="o">=</span><span class="s">".htmx-indicator"</span>
  <span class="na">hx-target</span><span class="o">=</span><span class="s">"#todo-results"</span>
  <span class="na">placeholder</span><span class="o">=</span><span class="s">"Search"</span>
  <span class="na">class</span><span class="o">=</span><span class="s">"bg-white h-10 px-5 pr-10 rounded-full text-2xl focus:outline-none"</span>
<span class="p">&gt;</span>
</code></pre></div>

<ol>
<li>输入向<code>/search</code>端点发送一个POST请求。</li>
<li>该请求通过延迟250毫秒的<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/keyup_event">击键事件</a>触发。因此，如果在上一次按键之后250毫秒之前输入了新的按键事件，则不会触发请求。</li>
<li>来自请求的HTML响应显示在<code>#todo-results</code>元素中。</li>
<li>我们还有一个指示器，它是一个加载元素，在发送请求后出现，在响应返回后消失。</li>
</ol>
<p>添加<em>模板/todo.html </em>文件:</p>
<div class="codehilite"><pre><span/><code><span class="cm">&lt;!-- templates/todo.html --&gt;</span>

{% for todo in todos %}
  <span class="p">&lt;</span><span class="nt">tr</span>
    <span class="na">class</span><span class="o">=</span><span class="s">"bg-white lg:hover:bg-gray-100 flex lg:table-row flex-row lg:flex-row flex-wrap lg:flex-no-wrap mb-10 lg:mb-0"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">"w-full lg:w-auto p-3 text-gray-800 text-center border border-b block lg:table-cell relative lg:static"</span><span class="p">&gt;</span>
      {{todo.id}}
    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">"w-full lg:w-auto p-3 text-gray-800 text-center border border-b block lg:table-cell relative lg:static"</span><span class="p">&gt;</span>
      {{todo.title}}
    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">"w-full lg:w-auto p-3 text-gray-800 text-center border border-b block lg:table-cell relative lg:static"</span><span class="p">&gt;</span>
      {% if todo.completed %}
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"rounded bg-green-400 py-1 px-3 text-xs font-bold"</span><span class="p">&gt;</span>Yes<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      {% else %}
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"rounded bg-red-400 py-1 px-3 text-xs font-bold"</span><span class="p">&gt;</span>No<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      {% endif %}
    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
{% endfor %}
</code></pre></div>

<p>该文件呈现了与我们的搜索查询相匹配的待办事项。</p>
<p>生成一个新的<em> src/output.css </em>文件:</p>
<div class="codehilite"><pre><span/><code><span class="o">(</span>venv<span class="o">)</span>$ tailwindcss -i ./static/src/main.css -o ./static/src/output.css --minify
</code></pre></div>

<p>使用<code>python manage.py runserver</code>运行应用程序，并再次导航到<a href="http://localhost:8000"> http://localhost:8000 </a>进行测试。</p>
<p><img data-src="/static/images/blog/flask-htmx-tailwind/demo.gif" loading="lazy" class="lazyload" alt="demo" src="../Images/3730463a9a4da831f9cc3849a19e8c52.png" data-original-src="https://testdriven.io/static/images/blog/flask-htmx-tailwind/demo.gif"/></p>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们学习了如何:</p>
<ul>
<li>设置Django压缩机和顺风CSS</li>
<li>使用Django、Tailwind CSS和htmx构建一个实时搜索应用程序</li>
</ul>
<p>htmx可以在不重新加载页面的情况下呈现元素。最重要的是，您无需编写任何JavaScript就可以实现这一点。虽然这减少了客户端所需的工作量，但从服务器发送的数据可能会更多，因为它发送的是渲染的HTML。</p>
<p>像这样提供部分HTML模板在21世纪初很流行。htmx为这种方法提供了一种现代的变形。总的来说，由于React和Vue等框架的复杂性，提供部分模板再次变得流行起来。您还可以将WebSockets添加到组合中，以交付实时更改。著名的<a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html"> Phoenix LiveView </a>也使用了同样的方法。你可以在<a href="https://alistapart.com/article/the-future-of-web-software-is-html-over-websockets/">阅读更多关于HTML over WebSockets的内容，Web软件的未来是HTML-Over Web sockets</a>和<a href="/blog/html-over-websockets/"> HTML Over WebSockets </a>。</p>
<p>图书馆还年轻，但未来看起来很光明。</p>
<p>Tailwind是一个强大的CSS框架，专注于开发人员的生产力。虽然这个教程没有涉及到，但是Tailwind是高度可定制的。查看以下资源了解更多信息:</p>

<p>当使用Django时，一定要将htmx和Tailwind与Django Compressor耦合，以简化静态资产管理。</p>
<p>完整的代码可以在<a href="https://github.com/testdrivenio/django-htmx-tailwind"> django-htmx-tailwind </a>资源库中找到。</p>
  </div>

  </div>    
</body>
</html>