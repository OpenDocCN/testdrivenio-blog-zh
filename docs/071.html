<html>
<head>
<title>Working with Static and Media Files in Django </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Django中使用静态和媒体文件</h1>
<blockquote>原文：<a href="https://testdriven.io/blog/django-static-files/#0001-01-01">https://testdriven.io/blog/django-static-files/#0001-01-01</a></blockquote><div><div class="blog-content long-content" data-local-nav-source="">
    <p>本文着眼于如何在Django项目中，在本地和生产中处理静态和媒体文件。</p>



<h2 id="objectives">目标</h2>
<p>完成本文后，您将能够:</p>
<ol>
<li>描述你通常会在Django项目中找到的三种不同类型的文件</li>
<li>解释静态文件和媒体文件的区别</li>
<li>在本地和生产中处理静态和媒体文件</li>
</ol>
<h2 id="types-of-files">文件类型</h2>
<p>Django是一个固执己见的全栈web应用框架。它配有许多<a href="https://docs.djangoproject.com/en/4.0/ref/contrib/">电池</a>，你可以用它们来构建一个全功能的网络应用，包括静态和媒体文件管理。</p>
<p>在我们看<em>如何</em>之前，我们先来看一些定义。</p>
<p><em>什么是静态和媒体文件？</em></p>
<p>首先，您通常会在Django项目中找到这三种类型的文件:</p>
<ol>
<li><strong>源代码</strong>:这些是组成每个Django项目的核心Python模块和HTML文件，您可以在其中定义模型、视图和模板。</li>
<li>静态文件:这些是你的CSS样式表、JavaScript文件、字体和图片。由于不涉及任何处理，这些文件非常节能，因为它们可以按原样提供。它们也更容易缓存。</li>
<li><strong>媒体文件</strong>:这些是用户上传的文件。</li>
</ol>
<p>本文主要关注静态和媒体文件。尽管名称不同，但两者都表示常规文件。最大的区别是静态文件保存在版本控制中，并在部署过程中与源代码文件一起发布。另一方面，媒体文件是您的最终用户(内部和外部)上传或由您的应用程序动态创建的文件(通常是一些用户操作的副作用)。</p>
<p><em>为什么要区别对待静态文件和媒体文件？</em></p>
<ol>
<li>您不能信任最终用户上传的文件，因此媒体文件需要区别对待。</li>
<li>您可能需要对用户上传的媒体文件进行处理，以便更好地提供服务，例如，您可以优化上传的图像以支持不同的设备。</li>
<li>您不希望用户上传的文件意外地替换了静态文件。</li>
</ol>
<blockquote>
<p>附加说明:</p>
<ol>
<li>静态和媒体文件有时被称为静态和媒体资产。</li>
<li>Django admin附带了一些静态文件，它们存储在<a href="https://github.com/django/django/tree/main/django/contrib/admin/static/admin"> GitHub </a>的版本控制中。</li>
<li>更容易混淆静态文件和媒体文件的是，Django文档本身并没有很好地区分这两者。</li>
</ol>
</blockquote>
<h2 id="static-files">静态文件</h2>
<p>Django为处理静态文件提供了强大的功能，被恰当地命名为<a href="https://docs.djangoproject.com/en/4.0/ref/contrib/staticfiles/"> staticfiles </a>。</p>
<p>如果您是staticfiles应用程序的新手，请快速浏览Django文档中的<a href="https://docs.djangoproject.com/en/4.0/howto/static-files/">如何管理静态文件(例如，图像、JavaScript、CSS) </a>指南。</p>
<p>Django的staticfiles应用程序提供了以下核心组件:</p>
<ol>
<li>设置</li>
<li>管理命令</li>
<li>存储类别</li>
<li>模板标签</li>
</ol>
<h3 id="settings">设置</h3>
<p>根据您的环境，您<em>可能</em>需要配置许多<a href="https://docs.djangoproject.com/en/4.0/ref/settings/#settings-staticfiles">设置</a>:</p>
<ol>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#static-url"> STATIC_URL </a>:用户可以在浏览器中访问您的静态文件的URL。默认值是<code>/static/</code>，这意味着您的文件将在开发模式下的<code>http://127.0.0.1:8000/static/</code>可用——例如<code>http://127.0.0.1:8000/static/css/main.css</code>。</li>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#static-root">STATIC _ ROOT</a>:Django应用程序服务静态文件的目录的绝对路径。当您运行<a href="https://docs.djangoproject.com/en/4.0/ref/contrib/staticfiles/#django-admin-collectstatic"> collectstatic </a>管理命令时(稍后会有更多介绍)，它会找到所有静态文件并将它们复制到这个目录中。</li>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#staticfiles-dirs"> STATICFILES_DIRS </a>:默认情况下，静态文件在<code>&lt;APP_NAME&gt;/static/</code>存储在app级。collectstatic命令将在这些目录中查找静态文件。您还可以用<code>STATICFILES_DIRS</code>告诉Django在其他位置寻找静态文件。</li>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#staticfiles-storage"> STATICFILES_STORAGE </a>:您想要使用的文件存储类，它控制静态文件的存储和访问方式。文件通过<a href="https://docs.djangoproject.com/en/4.0/ref/contrib/staticfiles/#staticfilesstorage">静态文件存储</a>存储在文件系统中。</li>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-STATICFILES_FINDERS"> STATICFILES_FINDERS </a>:该设置定义了用于自动查找静态文件的文件查找器后端。默认情况下，使用<code>FileSystemFinder</code>和<code>AppDirectoriesFinder</code>查找器:<ul>
<li><code>FileSystemFinder</code> -使用<code>STATICFILES_DIRS</code>设置查找文件。</li>
<li><code>AppDirectoriesFinder</code> -在项目内的每个Django应用程序的“静态”文件夹中查找文件。</li>
</ul>
</li>
</ol>
<h3 id="management-commands">管理命令</h3>
<p>staticfiles应用程序提供了以下<a href="https://docs.djangoproject.com/en/4.0/ref/contrib/staticfiles/#management-commands">管理命令</a>:</p>
<ol>
<li><code>collectstatic</code>是一个管理命令，从不同的位置收集静态文件-即<code>&lt;APP_NAME&gt;/static/</code>和在<code>STATICFILES_DIRS</code>设置中找到的目录-并将它们复制到<code>STATIC_ROOT</code>目录。</li>
<li><code>findstatic</code>是调试时使用的一个非常有用的命令，因此您可以确切地看到特定文件的来源</li>
<li>启动一个轻量级的开发服务器来运行开发中的Django应用程序。</li>
</ol>
<p>注意事项:</p>
<ol>
<li>不要将任何静态文件放在<code>STATIC_ROOT</code>目录中。运行<code>collectstatic</code>后，静态文件会自动复制到那里。相反，总是将它们放在与<code>STATICFILES_DIRS</code>设置或<code>&lt;APP_NAME&gt;/static/</code>相关的目录中。</li>
<li>不要在生产中使用开发服务器。请改用生产级的WSGI应用服务器。稍后会有更多内容。</li>
</ol>
<blockquote>
<p><strong><code>findstatic</code>命令的快速示例:</strong></p><p>假设你有两个Django应用，<code>app1</code>和<code>app2</code>。每个应用程序都有一个名为“静态”的文件夹，在每个文件夹中，都有一个名为<em> app.css </em>的文件。来自<em> settings.py </em>的相关设置:</p>
<div class="codehilite"><pre><span/><code><span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="s1">'staticfiles'</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s1">'app1'</span><span class="p">,</span>
    <span class="s1">'app2'</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div><p>运行<code>python manage.py collectstatic</code>时，将创建“staticfiles”目录，并将适当的静态文件复制到其中:</p><div class="codehilite"><pre><span/><code>$ ls staticfiles/

admin   app.css
</code></pre></div><p>只有一个<em> app.css </em>文件，因为当存在多个同名文件时，staticfiles finder将使用第一个找到的文件。要查看哪个文件被复制，您可以使用<code>findstatic</code>命令:</p><div class="codehilite"><pre><span/><code>$ python manage.py findstatic app.css

Found <span class="s1">'app.css'</span> here:
  /app1/static/app.css
  /app2/static/app.css
</code></pre></div><p>由于只收集第一个遇到的文件，要检查复制到“staticfiles”目录的<em> app.css </em>的源代码，请运行:</p><div class="codehilite"><pre><span/><code>$ python manage.py findstatic app.css --first

Found <span class="s1">'app.css'</span> here:
  /app1/static/app.css
</code></pre></div>
</blockquote>

<h3 id="storage-classes">存储类别</h3>
<p>当运行<code>collectstatic</code>命令时，Django使用存储类来决定如何存储和访问静态文件。同样，这是通过<a href="https://docs.djangoproject.com/en/4.0/ref/settings/#staticfiles-storage"> STATICFILES_STORAGE </a>设置来配置的。</p>
<p>默认的存储类是<a href="https://docs.djangoproject.com/en/4.0/ref/contrib/staticfiles/#staticfilesstorage">静态文件存储</a>。在后台，<code>StaticFilesStorage</code>使用<a href="https://docs.djangoproject.com/en/4.0/ref/files/storage/#the-filesystemstorage-class"> FileSystemStorage </a>类在本地文件系统上存储文件。</p>
<p>您可能希望在生产中偏离默认设置。例如，<a href="https://django-storages.readthedocs.io/en/latest/"> django-storages </a>为不同的云/CDN提供商提供了一些定制的存储类。您还可以使用<a href="https://docs.djangoproject.com/en/4.0/ref/files/storage/">文件存储API </a>编写自己的存储类。查看<a href="https://docs.djangoproject.com/en/4.0/howto/static-files/deployment/#serving-static-files-from-a-cloud-service-or-cdn">云服务或CDN </a>提供的静态文件，了解更多相关信息。</p>
<p>存储类可用于执行后处理任务，如<a href="https://developer.mozilla.org/en-US/docs/Glossary/minification">缩小</a>。</p>

<p>要在模板文件中加载静态文件，您需要:</p>
<ol>
<li>将<code>{% load static %}</code>添加到模板文件的顶部</li>
<li>然后，为您想要链接的每个文件添加<code>{% static %}</code>模板标签</li>
</ol>
<p>例如:</p>
<div class="codehilite"><pre><span/><code>{% load static %}

<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% static 'base.css' %}"</span><span class="p">&gt;</span>
</code></pre></div>

<p>这些标签共同生成一个完整的URL——例如，<code>/static/base.css</code>——基于<em> settings.py </em>文件中的静态文件配置。</p>
<p>您应该总是以这种方式加载静态文件，而不是直接硬编码URL，这样您就可以更改您的静态文件配置并指向不同的<code>STATIC_URL</code>，而不必手动更新每个模板。</p>
<blockquote>
<p>关于这些模板标签的更多信息，请查看<a href="https://docs.djangoproject.com/en/4.0/ref/templates/builtins/">内置模板标签和过滤器</a>中的<a href="https://docs.djangoproject.com/en/4.0/ref/templates/builtins/#static">静态</a>部分。</p>
</blockquote>
<h2 id="static-files-in-development-mode">开发模式下的静态文件</h2>
<p>在开发过程中，只要你将<code>DEBUG</code>设置为<code>TRUE</code>并且使用<a href="https://docs.djangoproject.com/en/4.0/ref/contrib/staticfiles/"> staticfiles </a>应用，你就可以使用Django的开发服务器提供静态文件。你甚至不需要运行<code>collecstatic</code>命令。</p>
<p>典型开发配置:</p>
<div class="codehilite"><pre><span/><code><span class="c1"># settings.py</span>
<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s1">'/static/'</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'staticfiles'</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span><span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'static'</span><span class="p">,]</span>
<span class="n">STATICFILES_STORAGE</span> <span class="o">=</span> <span class="s1">'django.contrib.staticfiles.storage.StaticFilesStorage'</span>
</code></pre></div>

<p><img data-src="/static/images/blog/django/django-static-files/static_files_dev.png" loading="lazy" class="lazyload" alt="Django static files in development mode" src="../Images/7959a14904cc9facb17b0bc2260b8009.png" data-original-src="https://testdriven.io/static/images/blog/django/django-static-files/static_files_dev.png"/></p>
<h2 id="static-files-in-production">生产中的静态文件</h2>
<p>在生产中处理静态文件并不像您的开发环境那样容易，因为您将使用WSGI(如<a href="https://gunicorn.org/"> Gunicorn </a>)或ASGI(如<a href="https://www.uvicorn.org/"> Uvicorn </a>)兼容的web应用服务器，它们用于提供动态内容——即您的Django源代码文件。</p>
<p>在生产中有许多不同的方法来处理静态文件，但是最流行的两种方法是:</p>
<ol>
<li>使用像<a href="https://www.nginx.com"> Nginx </a>这样的web服务器将静态文件的流量直接路由到静态根目录(通过<code>STATIC_ROOT</code>配置)</li>
<li>使用<a href="https://whitenoise.evans.io/en/stable/">whiten noise</a>直接从WSGI或ASGI web应用服务器提供静态文件</li>
</ol>
<p>不管选择哪一种，您可能都希望利用一个<a href="https://en.wikipedia.org/wiki/Content_delivery_network"> CDN </a>。</p>
<blockquote>
<p>有关这些选项的更多信息，请查看<a href="https://docs.djangoproject.com/en/4.0/howto/static-files/deployment/">如何部署静态文件</a>。</p>
</blockquote>
<h3 id="nginx">Nginx</h3>
<p>Nginx配置示例:</p>
<div class="codehilite"><pre><span/><code><span class="nt">upstream</span><span class="w"> </span><span class="nt">hello_django</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="err">server</span><span class="w"> </span><span class="n">web</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span><span class="w"/>
<span class="p">}</span><span class="w"/>

<span class="nt">server</span><span class="w"> </span><span class="p">{</span><span class="w"/>

<span class="w">    </span><span class="err">listen</span><span class="w"> </span><span class="err">80</span><span class="p">;</span><span class="w"/>

<span class="w">    </span><span class="err">location</span><span class="w"> </span><span class="err">/</span><span class="w"> </span><span class="err">{</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_pass</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">hello_django</span><span class="p">;</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_set_header</span><span class="w"> </span><span class="err">X-Forwarded-For</span><span class="w"> </span><span class="err">$proxy_add_x_forwarded_for</span><span class="p">;</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_set_header</span><span class="w"> </span><span class="err">Host</span><span class="w"> </span><span class="err">$host</span><span class="p">;</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_redirect</span><span class="w"> </span><span class="err">off</span><span class="p">;</span><span class="w"/>
<span class="w">    </span><span class="p">}</span><span class="w"/>

<span class="w">    </span><span class="nt">location</span><span class="w"> </span><span class="o">/</span><span class="nt">static</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="err">alias</span><span class="w"> </span><span class="err">/home/app/web/staticfiles/</span><span class="p">;</span><span class="w"/>
<span class="w">    </span><span class="p">}</span><span class="w"/>

<span class="err">}</span><span class="w"/>
</code></pre></div>

<p>简而言之，当一个请求被发送到<code>/static/</code>——例如<code>/static/base.css</code>——Nginx将尝试从“/home/app/web/staticfiles/”文件夹中提供文件。</p>
<blockquote>
<p>好奇上面的Nginx配置是如何工作的？查看使用Postgres、Gunicorn和Nginx的教程。</p>
</blockquote>
<p>其他资源:</p>
<ol>
<li>更喜欢把你的静态文件存储在亚马逊S3 上？查看在亚马逊S3 上存储Django静态和媒体文件的<a href="/blog/storing-django-static-and-media-files-on-amazon-s3/">。</a></li>
<li>更喜欢将您的静态文件存储在<a href="https://www.digitalocean.com/products/spaces">数字海洋空间</a>上？查看<a href="/blog/django-digitalocean-spaces/">在数字海洋空间</a>存储Django静态和媒体文件。</li>
</ol>
<h3 id="whitenoise">白噪声</h3>
<p>您可以使用<a href="http://whitenoise.evans.io/en/stable/">whiten noise</a>从WSGI或ASGI web应用服务器提供静态文件。</p>
<p>最基本的设置很简单。安装完软件包后，将WhiteNoise添加到除了<code>django.middleware.security.SecurityMiddleware</code>之外的所有其他中间件之上的<code>MIDDLEWARE</code>列表中:</p>
<div class="codehilite"><pre><span/><code><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'django.middleware.security.SecurityMiddleware'</span><span class="p">,</span>
    <span class="s1">'whitenoise.middleware.WhiteNoiseMiddleware'</span><span class="p">,</span>  <span class="c1"># &lt;---- WhiteNoise!</span>
    <span class="s1">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="p">,</span>
    <span class="s1">'django.middleware.common.CommonMiddleware'</span><span class="p">,</span>
    <span class="s1">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="p">,</span>
    <span class="s1">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="p">,</span>
    <span class="s1">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="p">,</span>
    <span class="s1">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<p>然后，为了支持压缩和缓存，像这样更新<code>STATICFILES_STORAGE</code>:</p>
<div class="codehilite"><pre><span/><code><span class="n">STATICFILES_STORAGE</span> <span class="o">=</span> <span class="s1">'whitenoise.storage.CompressedManifestStaticFilesStorage'</span>
</code></pre></div>

<p>就是这样！关闭调试模式，运行<code>collectstatic</code>命令，然后运行WSGI或ASGI web应用服务器。</p>
<blockquote>
<p>有关配置WhiteNoise与Django配合使用的更多信息，请参考<a href="http://whitenoise.evans.io/en/stable/django.html">结合Django使用white noise</a>指南。</p>
</blockquote>

<p>同样，<a href="https://docs.djangoproject.com/en/4.0/topics/files/">媒体文件</a>是您的最终用户(内部和外部)上传或由您的应用程序动态创建的文件(通常是一些用户操作的副作用)。它们通常不在版本控制中。</p>
<p>几乎总是，与<a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#filefield">文件字段</a>或<a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#imagefield">图像字段</a>模型字段相关联的文件应该被视为媒体文件。</p>
<p>与静态文件一样，媒体文件的处理在<em> settings.py </em>文件中配置。</p>
<p>处理媒体文件的基本配置设置:</p>
<ol>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#media-url"> MEDIA_URL </a>:类似于<code>STATIC_URL</code>，这是用户可以访问媒体文件的URL。</li>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#media-root">MEDIA _ ROOT</a>:Django应用程序提供媒体文件的目录的绝对路径。</li>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#default-file-storage"> DEFAULT_FILE_STORAGE </a>:您想要使用的文件存储类，它控制媒体文件的存储和访问方式。默认为<a href="https://docs.djangoproject.com/en/4.0/ref/files/storage/#django.core.files.storage.FileSystemStorage">文件系统存储</a>。</li>
</ol>
<blockquote>
<p>参考<a href="https://docs.djangoproject.com/en/4.0/ref/settings/">设置</a>中的<a href="https://docs.djangoproject.com/en/4.0/ref/settings/#file-uploads">文件上传</a>部分了解更多配置设置。</p>
</blockquote>

<p>典型开发配置:</p>
<div class="codehilite"><pre><span/><code><span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">'/media/'</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'uploads'</span>
</code></pre></div>

<p>不幸的是，Django开发服务器默认不提供媒体文件。幸运的是，有一个非常简单的解决方法:您可以将媒体根作为静态路径添加到项目级URL中的<code>ROOT_URLCONF</code>。</p>
<p>示例:</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c1"># ... the rest of your URLconf goes here ...</span>
<span class="p">]</span>

<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>
</code></pre></div>


<p>当涉及到在生产中处理媒体文件时，您的选择比静态文件少，因为您<a href="https://whitenoise.evans.io/en/stable/django.html#serving-media-files">不能使用WhiteNoise来提供媒体文件</a>。因此，你通常会希望使用Nginx和<a href="https://django-storages.readthedocs.io/en/latest/"> django-storages </a>来存储本地文件系统之外的媒体文件，应用程序在本地文件系统中运行。</p>
<p>Nginx配置示例:</p>
<div class="codehilite"><pre><span/><code><span class="nt">upstream</span><span class="w"> </span><span class="nt">hello_django</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">    </span><span class="err">server</span><span class="w"> </span><span class="n">web</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span><span class="w"/>
<span class="p">}</span><span class="w"/>

<span class="nt">server</span><span class="w"> </span><span class="p">{</span><span class="w"/>

<span class="w">    </span><span class="err">listen</span><span class="w"> </span><span class="err">80</span><span class="p">;</span><span class="w"/>

<span class="w">    </span><span class="err">location</span><span class="w"> </span><span class="err">/</span><span class="w"> </span><span class="err">{</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_pass</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">hello_django</span><span class="p">;</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_set_header</span><span class="w"> </span><span class="err">X-Forwarded-For</span><span class="w"> </span><span class="err">$proxy_add_x_forwarded_for</span><span class="p">;</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_set_header</span><span class="w"> </span><span class="err">Host</span><span class="w"> </span><span class="err">$host</span><span class="p">;</span><span class="w"/>
<span class="w">        </span><span class="err">proxy_redirect</span><span class="w"> </span><span class="err">off</span><span class="p">;</span><span class="w"/>
<span class="w">    </span><span class="p">}</span><span class="w"/>

<span class="w">    </span><span class="nt">location</span><span class="w"> </span><span class="o">/</span><span class="nt">media</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="w"/>
<span class="w">        </span><span class="err">alias</span><span class="w"> </span><span class="err">/home/app/web/mediafiles/</span><span class="p">;</span><span class="w"/>
<span class="w">    </span><span class="p">}</span><span class="w"/>

<span class="err">}</span><span class="w"/>
</code></pre></div>

<p>因此，当一个请求被发送到<code>/media/</code>——例如<code>/media/upload.png</code>——Nginx将尝试从“/home/app/web/mediafiles/”文件夹中提供文件。</p>
<blockquote>
<p>好奇上面的Nginx配置是如何工作的？查看使用Postgres、Gunicorn和Nginx的教程。</p>
</blockquote>
<p>其他资源:</p>
<ol>
<li>更喜欢把你的媒体文件储存在亚马逊S3 上？查看在亚马逊S3 上存储Django静态和媒体文件的<a href="/blog/storing-django-static-and-media-files-on-amazon-s3/">。</a></li>
<li>更喜欢将您的媒体文件存储在<a href="https://www.digitalocean.com/products/spaces"> DigitalOcean Spaces </a>上？查看<a href="/blog/django-digitalocean-spaces/">在数字海洋空间</a>存储Django静态和媒体文件。</li>
</ol>
<h2 id="conclusion">结论</h2>
<p>静态文件和媒体文件是不同的，为了安全起见，必须区别对待。</p>
<p>在本文中，您看到了如何在开发和生产中提供静态和媒体文件的示例。此外，文章还涵盖了:</p>
<ol>
<li>两种类型文件的不同设置</li>
<li>Django如何用最少的配置处理它们</li>
</ol>
<p>您可以在这里找到一个简单的Django项目，其中包含为开发和生产中的静态文件以及开发中的媒体文件提供服务的示例。</p>
<p>本文只带您了解如何在Django中处理静态和媒体文件。它没有讨论静态文件的预处理/后处理，如缩小和捆绑。对于这样的任务，你必须使用像<a href="https://rollupjs.org/"> Rollup </a>、<a href="https://parceljs.org/">packet</a>或者<a href="https://webpack.js.org/"> webpack </a>这样的工具来建立复杂的构建过程。</p>
  </div>

  </div>    
</body>
</html>